// Generated by CoffeeScript 1.6.3
/*
 * mithgrid JavaScript Library v0.13.3060
 *
 * Date: Tue Oct 29 12:16:35 2013 -0400
 *
 * (c) Copyright University of Maryland 2011-2013.  All rights reserved.
 *
 * (c) Copyright Texas A&M University 2010.  All rights reserved.
 *
 * Portions of this code are copied from The SIMILE Project:
 *  (c) Copyright The SIMILE Project 2006. All rights reserved.
 *
 * Redistribution and use in source and binary forms, with or without
 * modification, are permitted provided that the following conditions
 * are met:
 *
 * 1. Redistributions of source code must retain the above copyright
 *    notice, this list of conditions and the following disclaimer.
 *
 * 2. Redistributions in binary form must reproduce the above copyright
 *    notice, this list of conditions and the following disclaimer in the
 *    documentation and/or other materials provided with the distribution.
 *
 * 3. The name of the author may not be used to endorse or promote products
 *    derived from this software without specific prior written permission.
 *
 * THIS SOFTWARE IS PROVIDED BY THE AUTHOR ``AS IS'' AND ANY EXPRESS OR
 * IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED WARRANTIES
 * OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE DISCLAIMED.
 * IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY DIRECT, INDIRECT,
 * INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT
 * NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE,
 * DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY
 * THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT
 * (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF
 * THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.
*/
(function(){var a,b,c,d,e=[].slice,f=[].indexOf||function(a){for(var b=0,c=this.length;b<c;b++)if(b in this&&this[b]===a)return b;return-1};b=this.MITHgrid!=null?this.MITHgrid:this.MITHgrid={},a=b,d=b,c=this.jQuery!=null?this.jQuery:this.jQuery={},function(b,c){var d,g,h;(typeof console!="undefined"&&console!==null?console.log:void 0)!=null?c.debug=console.log:c.debug=function(){},c.config={},c.config.noTimeouts=!1,c.error=function(){c.debug.call({},arguments);return{arguments:arguments}},c.deprecated=function(a,b){return function(){var c;c=1<=arguments.length?e.call(arguments,0):[],console.log("Call to deprecated function "+a+".");return b.apply(null,c)}},c.namespace=function(a,b){return g(c,a,b)},g=function(a,b,d){var e,f;e=b.split(".");while(e.length>1)a[e[0]]||(a=g(a,e[0]),e.shift());a[e[0]]==null&&(f={namespace:function(a,b){return g(f,a,b)},debug:c.debug},a[e[0]]=f),d!=null&&d(a[e[0]]);return a[e[0]]},c.globalNamespace=function(a,b){var d,e,f;d=window,d[a]||(d[a]={}),(e=d[a]).debug||(e.debug=c.debug),(f=d[a]).namespace||(f.namespace=function(b,c){return g(d[a],b,c)}),b!=null&&b(d[a]);return d[a]},c.normalizeArgs=function(){var a,c,d,f,g,h,i,j,k;a=1<=arguments.length?e.call(arguments,0):[],c=[],g=[],i=a.pop();while(b.isFunction(i)||b.isPlainObject(i))b.isFunction(i)?c.push(i):g.push(i),i=a.pop();a.push(i),c.length===0?d=function(){var a;a=1<=arguments.length?e.call(arguments,0):[]}:c.length===1?d=c[0]:d=function(){var a,b,d,f,g;b=1<=arguments.length?e.call(arguments,0):[],g=[];for(d=0,f=c.length;d<f;d++)a=c[d],g.push(a.apply(null,b));return g},g.length===0?h={}:g.length===1?h=g[0]:(g=g.reverse(),h=b.extend.apply(b,[!0,{}].concat(e.call(g)))),j=[];while(typeof a[0]=="string"){if((k=a[0].substr(0,1))==="#"||k===".")break;j.push(a.shift())}j=j.reverse(),b.isArray(a[0])&&(j=j.concat(a.shift())),a.length>0?f=a.pop():f=null;return[j,f,h,d]},d={},c.defaults=function(a,c){d[a]||(d[a]={});return d[a]=b.extend(!0,d[a],c)},c.initSynchronizer=function(a){var b,d,e,f;f={},b=1,d=!1,e=!1,f.increment=function(){return b+=1},f.add=function(a){return b+=a},f.decrement=function(){b-=1,b<=0&&d&&!e&&(e=!0,a!=null&&a());return b},f.done=function(b){d=!0,b!=null&&(a=b);return f.decrement()},f.process=function(a,b){var d,e;d=a.length;if(d>0){f.add(d),e=function(g){var h,i,j;h=g+100,h>d&&(h=d),c.config.noTimeouts&&(h=d);for(i=j=g;g<=h?j<h:j>h;i=g<=h?++j:--j)b(a[i]),f.decrement();if(h<d)return setTimeout(function(){return e(h)},0)};return c.config.noTimeouts?e(0):setTimeout(function(){return e(0)},0)}};return f},c.initEventFirer=function(a,c,d){var f,g,h,i,j,k,l,m,n,o,p;p={isPreventable:!!a,isUnicast:!!c,hasMemory:!!d},g=[],p.isPreventable&&g.push("stopOnFalse"),i=b.Callbacks(g.join(" ")),j=function(){return i.empty()},o=function(a){return i.remove(a)},f=function(a){i.add(a);return function(){return o(a)}},k=function(){var a;a=1<=arguments.length?e.call(arguments,0):[];return i.fire.apply(i,a)},p.isUnicast||p.isPreventable?(h=[],o=function(a){var b;return h=function(){var c,d,e;e=[];for(c=0,d=h.length;c<d;c++)b=h[c],b!==a&&e.push(b);return e}()},f=function(a){h.push(a);return function(){return o(a)}},p.isUnicast&&i.add(function(){var a;a=1<=arguments.length?e.call(arguments,0):[];if(h.length>0)return h[0].apply(h,a)}),p.isPreventable&&(k=function(){var a,b,c,d,f;a=1<=arguments.length?e.call(arguments,0):[];for(d=0,f=h.length;d<f;d++){b=h[d],c=b.apply(null,a);if(c===!1)return!1}return!0}),j=function(){h=[];return i.empty()}):p.hasMemory&&(l=[],m=f,f=function(a){var b,c,d;for(c=0,d=l.length;c<d;c++)b=l[c],a.apply(null,b);return m(a)},n=k,k=function(){var a;a=1<=arguments.length?e.call(arguments,0):[],l.push(a);return n.apply(null,a)},j=function(){l=[];return i.empty()}),p.addListener=f,p.removeListener=o,p.fire=k,p._destroy=j;return p},h=0,c.initInstance=function(){var a,g,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w,x,y,z,A;a=1<=arguments.length?e.call(arguments,0):[],x=c.normalizeArgs.apply(c,a),n=x[0],l=x[1],k=x[2],j=x[3],s={_mithgrid_type:"MITHgrid"},p=[],s.onDestroy=function(a){return p.push(a)},s._destroy=function(){var a,b,c,d,e,f,g,h,i;g=p.reverse();for(e=0,f=g.length;e<f;e++)j=g[e],j();p=[],h=s.events;for(a in h)c=h[a],c._destroy();i=[];for(b in s)d=s[b],i.push(delete s[b]);return i},r=[];if(n!=null){typeof n=="string"&&(n=[n]),s._mithgrid_type=n[0],n.reverse();for(v=0,w=n.length;v<w;v++){o=n[v],g=o.split("."),o=g.shift(),d[o]!=null&&r.push(d[o]);while(g.length>0)o=o+"."+g.shift(),d[o]!=null&&r.push(d[o])}}k!=null&&r.push(k),q=b.extend.apply(b,[!0,{}].concat(e.call(r))),h+=1,s.id=h,s.options=q,s.container=l,s.events={};if(s.options.events!=null){y=s.options.events;for(m in y)i=y[m],i!=null?typeof i=="string"&&(i=[i]):i=[],s.events[m]=c.initEventFirer(f.call(i,"preventable")>=0,f.call(i,"unicast")>=0,f.call(i,"memory")>=0)}s.addVariable=function(a,b){var d,e,g,h,i,j,k,l,m,n,o,p,q;q=b["default"],b.is||(b.is="rw"),f.call(b.is,"w")>=0&&(h=b.filter,p=b.validate,g=b.event||"on"+a+"Change",m=b.setter||"set"+a,d=b.adder||"add"+a,j=b.locker||"lock"+a,o=b.unlocker||"unlock"+a,s.events[g]=e=c.initEventFirer(),h!=null?p!=null?n=function(a){a=p(h(a));if(q!==a){q=a;return e.fire(q)}}:n=function(a){a=h(a);if(q!==a){q=a;return e.fire(q)}}:p!=null?n=function(a){a=p(a);if(q!==a){q=a;return e.fire(q)}}:n=function(a){if(q!==a){q=a;return e.fire(q)}},f.call(b.is,"l")>=0&&(k=0,s[j]=function(){return k+=1},s[o]=function(){return k-=1},l=n,n=function(a){if(k===0)return l(a)}),s[m]=n,b.isa==="numeric"&&(s[d]=function(a){return n(a+q)}));if(f.call(b.is,"r")>=0){i=b.getter||"get"+a;return s[i]=function(){return q}}};if(((z=s.options)!=null?z.variables:void 0)!=null){A=q.variables;for(t in A)k=A[t],s.addVariable(t,k)}(q!=null?q.viewSetup:void 0)!=null&&l!=null&&(u=q.viewSetup,b.isFunction(u)?b(document).ready(function(){return u(b(l))}):b(document).ready(function(){return b(l).append(u)})),j!=null&&j(s,l);return s},c.namespace("events",function(a){a.onWindowResize=c.initEventFirer(!1,!1);return b(document).ready(function(){return b(window).resize(function(){return c.config.noTimeouts?c.events.onWindowResize.fire():setTimeout(c.events.onWindowResize.fire,0)})})}),c.namespace("mouse",function(a){var c;c=[],a.capture=function(a){var d;d=c[0],c.unshift(a),c.length===1&&(b(document).mousemove(function(a){a.preventDefault();return c[0].call(a,"mousemove")}),b(document).mouseup(function(a){a.preventDefault();return c[0].call(a,"mouseup")}));return d};return a.uncapture=function(){var a;a=c.shift(),c.length===0&&(b(document).unbind("mousemove"),b(document).unbind("mouseup"));return a}}),c.namespace("Data",function(a){a.namespace("Set",function(a){return a.initInstance=function(a){var b,c,d,e,f,g,h,i;g={},d={},b=0,f=!0,e=[],g.items=function(){var a;if(f){e=[];for(a in d)typeof a=="string"&&d[a]===!0&&e.push(a)}return e},g.add=function(a){if(d[a]==null){d[a]=!0,f=!0;return b+=1}},g.remove=function(a){if(d[a]!=null){delete d[a],f=!0;return b-=1}},g.empty=function(){d={},b=0,f=!1,e=[];return!1},g.visit=function(a){var b;for(b in d)if(a(b)===!0)break;return!1},g.contains=function(a){return d[a]!=null},g.size=function(){return f?g.items().length:e.length};if(a instanceof Array)for(h=0,i=a.length;h<i;h++)c=a[h],g.add(c);return g}}),a.namespace("Type",function(a){return a.initInstance=function(a){var b;return b={name:a,custom:{}}}}),a.namespace("Property",function(a){return a.initInstance=function(a){var b;return b={name:a,getValueType:function(){var a;return(a=b.valueType)!=null?a:"text"}}}}),a.namespace("Store",function(d){return d.initInstance=function(){var d;d=1<=arguments.length?e.call(arguments,0):[];return c.initInstance.apply(c,["MITHgrid.Data.Store"].concat(e.call(d),[function(d){var e,f,g,h,i,j,k,l,m,n;k=!1,l=a.Set.initInstance(),n={},j={},m={},h={},i=d.options,d.items=l.items,d.contains=l.contains,d.visit=l.visit,d.size=l.size,g=function(a,b,c,d){var e,f,g;f=a[b];if(f==null){f={values:{},counts:{}},a[b]=f,f.values[c]=[d],f.counts[c]={};return f.counts[c][d]=1}g=f.values,e=f.counts;if(g[c]==null){g[c]=[d],e[c]={};return e[c][d]=1}g[c].push(d);return e[c][d]!=null?e[c][d]+=1:e[c][d]=1},f=function(a,b,c,d,e){var f,g,h,i,j,k,l;g=a[b];if(g!=null){f=g.values[c];if(f!=null)if(e!=null)for(i=0,k=f.length;i<k;i++)h=f[i],e.contains(h)&&d.add(h);else for(j=0,l=f.length;j<l;j++)h=f[j],d.add(h)}return!1},e=function(b,c,d,e,g){e==null&&(e=a.Set.initInstance()),c.visit(function(a){return f(b,a,d,e,g)});return e},d.addProperty=function(b,c){var d;d=a.Property.initInstance(b),(c!=null?c.valueType:void 0)!=null&&(d.valueType=c.valueType,j[b]=d);return d},d.getProperty=function(b){var c;return(c=j[b])!=null?c:a.Property.initInstance(b)},d.addType=function(b,c){var d;d=a.Type.initInstance(b),n[b]=d;return d},d.getType=function(b){var c;return(c=n[b])!=null?c:a.Type.initInstance(b)},d.getItem=function(a,b){var c,d,e;c=(d=(e=m[a])!=null?e.values:void 0)!=null?d:{};return b?b(null,c):c},d.getItems=function(a,b){var e,f,g,h,i,j,k;if(b!=null){f=c.initSyncronizer(b);if(a.length!=null)for(g=0,i=a.length;g<i;g++)e=a[g],f.increment(),d.getItem(e,function(a,c){b(a,c);return f.decrement()});else f.increment(),d.getItem(a,function(a,c){b(a,c);return f.decrement()});return f.done()}if(a.length){k=[];for(h=0,j=a.length;h<j;h++)e=a[h],k.push(d.getItem(e));return k}return[d.getItem(a)]},d.removeItems=function(a,c){var e,f,g,i,j,k,n,o;f=[],g=function(a,c,d,e){var f,g,h,i,j,k,l;h=a[c];if(h!=null){f=h.values[d],g=h.counts[d];if(f==null||g==null)return;g[e]-=1;if(g[e]<1){i=b.inArray(e,f),i===0?f=f.slice(1,f.length):i===f.length-1?f=f.slice(0,i):i>0&&(f=f.slice(0,i).concat(f.slice(i+1,f.length))),f.length>0?h.values[d]=f:delete h.values[d],delete g[e],k=0;for(j in g)l=g[j],k+=l;k===0&&delete a[c]}return!1}},i=function(a,b,c){g(m,a,b,c);return g(h,c,b,a)},k=function(a,b,c){var d,e,f,g;g=[];for(e=0,f=c.length;e<f;e++)d=c[e],g.push(i(a,b,d));return g},j=function(a){var b,c,e;b=d.getItem(a);for(e in b){c=b[e];if(typeof e!="string"||e==="id")continue;k(a,e,c)}return k(a,"id",[a])};for(n=0,o=a.length;n<o;n++)e=a[n],j(e),f.push(e),l.remove(e);d.events.onModelChange.fire(d,f);if(c!=null)return c()},d.updateItems=function(a,e){var f,i,j,k,l,n,o,p;j=[],l=function(a,c,d,e){var f,g,h,i;h=a[c];if(h!=null){f=h.values[d],g=h.counts[d];if(f==null||g==null)return;g[e]-=1;if(g[e]<1){i=b.inArray(e,f),i===0?f=f.slice(1,f.length):i===f.length-1?f=f.slice(0,i):i>0&&(f=f.slice(0,i).concat(f.slice(i+1,f.length))),f.length>0?h.values[d]=f:delete h.values[d];return delete g[e]}}},k=function(a,b,c){g(m,a,b,c);return g(h,c,b,a)},n=function(a,b,c){l(m,a,b,c);return l(h,c,b,a)},p=function(c){var e,f,g,h,i,j,l,m;f=c.id,e=!1,g=function(a,b){var c,d,e,f;d=!0;if(a.length!==b.length)return!1;for(c=e=0,f=a.length;0<=f?e<f:e>f;c=0<=f?++e:--e)a[c]!==b[c]&&(d=!1);return d},l=function(a,b,c){var d,e,f,g;g=[];for(e=0,f=c.length;e<f;e++)d=c[e],g.push(n(a,b,d));return g},j=function(a,b,c){var d,e,f,g;g=[];for(e=0,f=c.length;e<f;e++)d=c[e],g.push(k(a,b,d));return g},b.isArray(f)&&(f=f[0]),h=d.getItem(f);for(i in c){a=c[i];if(typeof i!="string"||i==="id")continue;b.isArray(a)||(a=[a]),m=a.length,h[i]==null?(j(f,i,a),e=!0):g(a,h[i])||(e=!0,l(f,i,h[i]),j(f,i,a))}return e},d.events.onBeforeUpdating.fire(d),o=a.length,f=parseInt(o/100,10),f>500&&(f=500),f<100&&(f=100),i=function(b){var g,h,k,l;g=b+f;if(g>o||c.config.noTimeouts)g=o;for(k=l=b;b<=g?l<g:l>g;k=b<=g?++l:--l)h=a[k],typeof h=="object"&&p(h)&&j.push(h.id);if(g<o)return setTimeout(function(){return i(g)},0);d.events.onAfterUpdating.fire(d),d.events.onModelChange.fire(d,j);if(e!=null)return e()};return i(0)},d.loadItems=function(a,e){var f,i,j,k,n,o;j=[],k=function(a,b,c){g(m,a,b,c);return g(h,c,b,a)},n=function(a){var d,e,f,g,h;if(a.id==null)throw c.error("Item entry has no id: ",a);if(a.type==null)throw c.error("Item entry has no type: ",a);d=a.id,b.isArray(d)&&(d=d[0]),l.add(d),j.push(d),k(d,"id",d),h=[];for(e in a){f=a[e];if(typeof e!="string")continue;e!=="id"?b.isArray(f)?h.push(function(){var a,b,c;c=[];for(a=0,b=f.length;a<b;a++)g=f[a],c.push(k(d,e,g));return c}()):f!=null?h.push(k(d,e,f)):h.push(void 0):h.push(void 0)}return h},d.events.onBeforeLoading.fire(d),o=a.length,e!=null?(f=parseInt(o/100,10),f>500&&(f=500)):f=o,f<100&&(f=100),i=function(b){var g,h,k,l;g=b+f;if(g>o||c.config.noTimeouts)g=o;for(k=l=b;b<=g?l<g:l>g;k=b<=g?++l:--l)h=a[k],typeof h=="object"&&n(h);if(g<o)return setTimeout(function(){return i(g)},0);d.events.onAfterLoading.fire(d),d.events.onModelChange.fire(d,j);if(e!=null)return e()};return i(0)},d.prepare=function(a){var b,e,f,g;f=c.Expression.Basic.initInstance(),e=function(){var c,d,e;e=[];for(c=0,d=a.length;c<d;c++)b=a[c],e.push(f.parse(b));return e}(),g=void 0;return{evaluate:function(a){var c,f,h,i;c=[],g=void 0,f=function(b){var e;e=b.evaluateOnItem(a,d),g||(g=e.valueType);return c=c.concat(e.values.items())};for(h=0,i=e.length;h<i;h++)b=e[h],f(b);return c},valueType:function(){return g}}},d.getObjectsUnion=function(a,b,c,d){return e(m,a,b,c,d)},d.getSubjectsUnion=function(a,b,c,d){return e(h,a,b,c,d)};return d.registerPresentation=function(a){a.onDestroy(d.events.onModelChange.addListener(function(b,c){return a.eventModelChange(b,c)}));return a.eventModelChange(d,d.items())}}]))}}),a.namespace("View",function(b){return b.initInstance=function(){var b;b=1<=arguments.length?e.call(arguments,0):[];return c.initInstance.apply(c,["MITHgrid.Data.View"].concat(e.call(b),[function(b){var d,e,g,h,i,j,k,l,m,n;k=a.Set.initInstance(),i=b.options,e=function(a){return!1!==b.events.onFilterItem.fire(b.dataStore,a)},g=function(a){var d,f,g,h;g=b.dataStore.items(),h=g.length;if(h===0)a();else{h>200?(d=parseInt(h/100,10),d>500&&(d=500)):d=h,d<100&&(d=100),f=function(i){var j,l,m,n;j=i+d;if(j>h||c.config.noTimeouts)j=h;for(l=n=i;i<=j?n<j:n>j;l=i<=j?++n:--n)m=g[l],e(m)?k.add(m):k.remove(m);if(j<h)return setTimeout(function(){return f(j)},0);b.items=k.items,b.size=k.size,b.contains=k.contains,b.visit=k.visit;if(a!=null)return a()};return f(0)}},b.registerFilter=function(a){b.events.onFilterItem.addListener(function(b,c){return a.eventFilterItem(b,c)}),b.events.onModelChange.addListener(function(b,c){return a.eventModelChange(b,c)});return a.events.onFilterChange.addListener(b.eventFilterChange)},b.registerPresentation=function(a){a.onDestroy(b.events.onModelChange.addListener(function(b,c){return a.eventModelChange(b,c)}));return g(function(){return a.eventModelChange(b,b.items())})},b.items=k.items,b.contains=k.contains,b.visit=k.visit,b.size=k.size,b.eventFilterChange=function(){var c;c=a.Set.initInstance(b.items());return g(function(){var d,e,f,g,h,i,j,k;d=a.Set.initInstance(),j=c.items();for(f=0,h=j.length;f<h;f++)e=j[f],b.contains(e)||d.add(e);k=b.items();for(g=0,i=k.length;g<i;g++)e=k[g],c.contains(e)||d.add(e);if(d.size()>0)return b.events.onModelChange.fire(b,d.items())})},b.eventModelChange=function(c,d){var f,g,h,i;f=a.Set.initInstance();for(h=0,i=d.length;h<i;h++)g=d[h],c.contains(g)?e(g)?(k.add(g),f.add(g)):k.contains(g)&&(f.add(g),k.remove(g)):(f.add(g),k.remove(g));return b.events.onModelChange.fire(b,f.items())},(i!=null?(m=i.types)!=null?m.length:void 0:void 0)>0&&function(a){return b.registerFilter({eventFilterItem:function(b,c){var d,e,g,h;d=b.getItem(c);if(d.type==null)return!1;for(g=0,h=a.length;g<h;g++){e=a[g];if(f.call(d.type,e)>=0)return}return!1},eventModelChange:function(a,b){},events:{onFilterChange:{addListener:function(a){}}}})}(i.types),(i!=null?(n=i.filters)!=null?n.length:void 0:void 0)>0&&function(a){var d,e,f;f=c.Expression.Basic.initInstance(),e=function(){var b,c,e;e=[];for(b=0,c=a.length;b<c;b++)d=a[b],e.push(f.parse(d));return e}();return b.registerFilter({eventFilterItem:function(a,b){var c,f,g,h,i,j;for(g=0,i=e.length;g<i;g++){d=e[g],f=d.evaluateOnItem(b,a),f=f.values.items();for(h=0,j=f.length;h<j;h++){c=f[h];if(c!=="false")return}}return!1},eventModelChange:function(a,b){},events:{onFilterChange:{addListener:function(a){}}}})}(i.filters),(i!=null?i.collection:void 0)!=null&&b.registerFilter({eventFilterItem:i.collection,eventModelChange:function(a,b){},events:{onFilterChange:{addListener:function(a){}}}}),(i!=null?i.expressions:void 0)!=null&&(d=i.dataStore.prepare(i.expressions),j=b.eventModelChange,h=c.Data.Store.initInstance({}),l=c.Data.Set.initInstance(),b.eventModelChange=function(a,b){var e,g,i,k,m,n,o,p,q,r,s,t,u;m=[],o=[],i=c.Data.Set.initInstance(),i=h.getObjectsUnion(l,"mapsTo",i);for(q=0,s=b.length;q<s;q++){e=b[q];if(i.contains(e))m.push(e),a.contains(e)||(g=c.Data.Set.initInstance(),h.getSubjectsUnion(c.Data.Set.initInstance([e]),"mapsTo",g),g.visit(function(a){var b,c,d;c=h.getItem(a),d=c.mapsTo;if(d!=null){b=d.indexOf(e),b===0?d=d.slice(1,d.length):b===d.length-1?d=d.slice(0,d.length-1):b>-1&&(d=d.slice(0,b).concat(d.slice(b+1,d.length)));return h.updateItems([{id:a,mapsTo:d}])}}));else if(a.contains(e)){n=c.Data.Set.initInstance(),u=d.evaluate([e]);for(r=0,t=u.length;r<t;r++)p=u[r],n.add(p);h.contains(e)?h.updateItems([{id:e,mapsTo:n.items()}]):h.loadItems([{id:e,mapsTo:n.items()}])}else m=m.concat(h.getItem(e).mapsTo),o.push(e)}o.length>0&&h.removeItems(o),i=c.Data.Set.initInstance(),h.getObjectsUnion(l,"mapsTo",i),m=function(){var a,c,d;d=[];for(a=0,c=m.length;a<c;a++)k=m[a],f.call(b,k)>=0&&d.push(k);return d}();return j(i,m)}),b.dataStore=i.dataStore,b.getItems=b.dataStore.getItems,b.getItem=b.dataStore.getItem,b.removeItems=b.dataStore.removeItems,b.updateItems=b.dataStore.updateItems,b.loadItems=b.dataStore.loadItems,b.prepare=b.dataStore.prepare,b.addType=b.dataStore.addType,b.getType=b.dataStore.getType,b.addProperty=b.dataStore.addProperty,b.getProperty=b.dataStore.getProperty,b.getObjectsUnion=b.dataStore.getObjectsUnion,b.getSubjectsUnion=b.dataStore.getSubjectsUnion,b.dataStore.events.onModelChange.addListener(b.eventModelChange);return b.eventModelChange(b.dataStore,b.dataStore.items())}]))}}),a.namespace("SubSet",function(b){return b.initInstance=function(){var b;b=1<=arguments.length?e.call(arguments,0):[];return c.initInstance.apply(c,["MITHgrid.Data.SubSet"].concat(e.call(b),[function(b){var c,d,e;d=b.options,e=a.Set.initInstance(),b.items=e.items,b.contains=e.contains,b.visit=e.visit,b.size=e.size,b.setKey=function(d){var f,g,h;g=d,h=a.Set.initInstance(c.evaluate([g])),f=[],e.visit(function(a){if(!h.contains(a)){e.remove(a);return f.push(a)}}),h.visit(function(a){if(!e.contains(a)){e.add(a);return f.push(a)}});if(f.length>0)return b.events.onModelChange.fire(b,f)},c=d.dataStore.prepare(d.expressions),b.eventModelChange=function(d,f){var g,h,i,j,k;typeof key!="undefined"&&key!==null?i=a.Set.initInstance(c.evaluate([key])):i=a.Set.initInstance(),g=[];for(j=0,k=f.length;j<k;j++)h=f[j],e.contains(h)?(g.push(h),i.contains(h)||e.remove(h)):i.contains(h)&&(e.add(h),g.push(h));if(g.length>0)return b.events.onModelChange.fire(b,g)},b.dataStore=d.dataStore,b.getItems=b.dataStore.getItems,b.getItem=b.dataStore.getItem,b.removeItems=b.dataStore.removeItems,b.fetchData=b.dataStore.fetchData,b.updateItems=b.dataStore.updateItems,b.loadItems=b.dataStore.loadItems,b.prepare=b.dataStore.prepare,b.addType=b.dataStore.addType,b.getType=b.dataStore.getType,b.addProperty=b.dataStore.addProperty,b.getProperty=b.dataStore.getProperty,b.getObjectsUnion=b.dataStore.getObjectsUnion,b.getSubjectsUnion=b.dataStore.getSubjectsUnion,b.dataStore.events.onModelChange.addListener(b.eventModelChange),b.eventModelChange(b.dataStore,b.dataStore.items()),b.registerPresentation=function(a){a.onDestroy(b.events.onModelChange.addListener(function(b,c){return a.eventModelChange(b,c)}));return a.eventModelChange(b,b.items())};return b.setKey(d.key)}]))}}),a.namespace("ListPager",function(b){return b.initInstance=function(){var b;b=1<=arguments.length?e.call(arguments,0):[];return c.initInstance.apply(c,["MITHgrid.Data.ListPager"].concat(e.call(b),[function(b){var c,d,e,g,h,i,j,k;i=b.options,d=[],e=0,g=-1,h=void 0,j=void 0,c=function(a){return d.indexOf(a)},k=a.Set.initInstance(),b.items=k.items,b.size=k.size,b.contains=k.contains,b.visit=k.visit,b.dataStore=i.dataStore,b.getItems=b.dataStore.getItems,b.getItem=b.dataStore.getItem,b.removeItems=b.dataStore.removeItems,b.fetchData=b.dataStore.fetchData,b.updateItems=b.dataStore.updateItems,b.loadItems=b.dataStore.loadItems,b.prepare=b.dataStore.prepare,b.addType=b.dataStore.addType,b.getType=b.dataStore.getType,b.addProperty=b.dataStore.addProperty,b.getProperty=b.dataStore.getProperty,b.getObjectsUnion=b.dataStore.getObjectsUnion,b.getSubjectsUnion=b.dataStore.getSubjectsUnion,b.setList=function(a){var c,h,i,j,l,m,n,o,p;d=a,c=[];for(i=0,l=d.length;i<l;i++)h=d[i],b.dataStore.contains(h)&&!k.contains(h)?e<=(n=d.indexOf(h))&&n<g&&(c.push(h),k.add(h)):k.contains(h)&&!b.dataStore.contains(h)&&(c.push(h),k.remove(h));o=k.items();for(j=0,m=o.length;j<m;j++){h=o[j];if((p=!h,f.call(d,p)>=0)||!b.dataStore.contains(h))c.push(h),k.remove(h)}if(c.length>0)return b.events.onModelChange.fire(b,c)},b.eventModelChange=function(a,d){var f,h,i,j,l;f=[];for(j=0,l=d.length;j<l;j++)h=d[j],a.contains(h)?(i=c(h),k.contains(h)?(f.push(h),(e>i||i>=g)&&k.remove(h)):e<=i&&i<g&&(k.add(h),f.push(h))):(k.remove(h),f.push(h));if(f.length>0)return b.events.onModelChange.fire(b,f)},b.setKeyRange=function(c,f){var h,i,j,l,m;c<f?(e=c,g=f):(e=f,g=c),l=k,h=a.Set.initInstance(),k=a.Set.initInstance(),b.items=k.items,b.size=k.size,b.contains=k.contains,b.visit=k.visit;if(e<g)for(i=m=e;e<=g?m<=g:m>=g;i=e<=g?++m:--m)j=d[i],l.contains(j)||h.add(j),k.add(j);l.visit(function(a){if(!k.contains(a))return h.add(a)});if(h.size()>0)return b.events.onModelChange.fire(b,h.items())},b.dataStore.registerPresentation(b);return b.registerPresentation=function(a){a.onDestroy(b.events.onModelChange.addListener(function(b,c){return a.eventModelChange(b,c)}));return a.eventModelChange(b,b.items())}}]))}}),a.namespace("Pager",function(b){return b.initInstance=function(){var b;b=1<=arguments.length?e.call(arguments,0):[];return c.initInstance.apply(c,["MITHgrid.Data.Pager"].concat(e.call(b),[function(b){var c,d,e,f,g,h,i,j,k,l,m;k=b.options,g=[],h=-1,i=-1,j=void 0,l=void 0,e=function(a){var b,c,d;if(a==null)return 0;b=0,d=g.length-1;while(b<d)c=~~((b+d)/2),g[c][0]<a?b=c+1:g[c][0]===a?d=c:d=c-1;while(g[b]!=null&&g[b][0]<a)b+=1;return b},f=function(a){var b,c,d;if(a==null)return g.length-1;b=0,d=g.length-1;while(b<d)c=~~((b+d)/2),g[c][0]<a?b=c+1:d=c-1;while(d>=0&&g[d][0]>=a)d-=1;return d},d=function(a){var b,c,d;for(b=c=0,d=g.length;0<=d?c<d:c>d;b=0<=d?++c:--c)if(g[b][1]===a)return b;return-1},m=a.Set.initInstance(),b.items=m.items,b.size=m.size,b.contains=m.contains,b.visit=m.visit,b.dataStore=k.dataStore,b.getItems=b.dataStore.getItems,b.getItem=b.dataStore.getItem,b.removeItems=b.dataStore.removeItems,b.fetchData=b.dataStore.fetchData,b.updateItems=b.dataStore.updateItems,b.loadItems=b.dataStore.loadItems,b.prepare=b.dataStore.prepare,b.addType=b.dataStore.addType,b.getType=b.dataStore.getType,b.addProperty=b.dataStore.addProperty,b.getProperty=b.dataStore.getProperty,b.getObjectsUnion=b.dataStore.getObjectsUnion,b.getSubjectsUnion=b.dataStore.getSubjectsUnion,c=b.prepare(k.expressions),b.eventModelChange=function(a,k){var n,o,p,q,r,s,t;n=[];for(s=0,t=k.length;s<t;s++)p=k[s],a.contains(p)?(r=c.evaluate(p),r.length>0?(c.valueType()==="numeric"?q=parseFloat(r[0]):q=r[0],m.contains(p)?(o=d(p),o===-1?g.push([q,p]):g[o][0]=q,n.push(p),(j!=null&&q<j||l!=null&&q>=l)&&m.remove(p)):(g.push([q,p]),(j==null||q>=j)&&(l==null||q<l)&&(m.add(p),n.push(p)))):m.contains(p)&&(o=d(p),o===0?g=g.slice(1,g.length):o===g.length-1?g=g.slice(0,g.length-1):o!==-1&&(g=g.slice(0,o).concat(g.slice(o+1,g.length))),m.remove(p),n.push(p))):(m.remove(p),n.push(p));g.sort(function(a,b){if(a[0]<b[0])return-1;if(a[0]>b[0])return 1;return 0}),h=e(j),i=f(l);if(n.length>0)return b.events.onModelChange.fire(b,n)},b.setKeyRange=function(c,d){var k,n,o,p,q;c!=null&&d!=null?c<d?(j=c,l=d):(j=d,l=c):(j=c,l=d),h=e(j),i=f(l),k=a.Set.initInstance(),p=m,m=a.Set.initInstance(),b.items=m.items,b.size=m.size,b.contains=m.contains,b.visit=m.visit;if(h<=i)for(n=q=h;h<=i?q<=i:q>=i;n=h<=i?++q:--q)o=g[n][1],p.contains(o)||k.add(o),m.add(o);p.visit(function(a){if(!m.contains(a))return k.add(a)});if(k.size()>0)return b.events.onModelChange.fire(b,k.items())},b.dataStore.registerPresentation(b);return b.registerPresentation=function(a){a.onDestroy(b.events.onModelChange.addListener(function(b,c){return a.eventModelChange(b,c)}));return a.eventModelChange(b,b.items())}}]))}});return a.namespace("RangePager",function(b){return b.initInstance=function(){var b;b=1<=arguments.length?e.call(arguments,0):[];return c.initInstance.apply(c,["MITHgrid.Data.RangePager"].concat(e.call(b),[function(b){var c,d,e,f;d=b.options,c=a.Pager.initInstance({dataStore:d.dataStore,expressions:d.leftExpressions}),e=a.Pager.initInstance({dataStore:d.dataStore,expressions:d.rightExpressions}),f=a.Set.initInstance(),b.items=f.items,b.size=f.size,b.contains=f.contains,b.visit=f.visit,b.dataStore=d.dataStore,b.getItems=b.dataStore.getItems,b.getItem=b.dataStore.getItem,b.removeItems=b.dataStore.removeItems,b.fetchData=b.dataStore.fetchData,b.updateItems=b.dataStore.updateItems,b.loadItems=b.dataStore.loadItems,b.prepare=b.dataStore.prepare,b.addType=b.dataStore.addType,b.getType=b.dataStore.getType,b.addProperty=b.dataStore.addProperty,b.getProperty=b.dataStore.getProperty,b.getObjectsUnion=b.dataStore.getObjectsUnion,b.getSubjectsUnion=b.dataStore.getSubjectsUnion,b.eventModelChange=function(a,d){var g,h,i,j;g=[];for(i=0,j=d.length;i<j;i++)h=d[i],c.contains(h)&&e.contains(h)?(g.push(h),f.add(h)):f.contains(h)&&(g.push(h),f.remove(h));return b.events.onModelChange.fire(b,g)},b.setKeyRange=function(a,b){var d;a!=null&&b!=null&&a>b&&(d=[b,a],a=d[0],b=d[1]),c.setKeyRange(void 0,b);return e.setKeyRange(a,void 0)},c.registerPresentation(b),e.registerPresentation(b),b.setKeyRange(void 0,void 0);return b.registerPresentation=function(a){a.onDestroy(b.events.onModelChange.addListener(function(b,c){return a.eventModelChange(b,c)}));return a.eventModelChange(b,b.items())}}]))}})}),c.Data.namespace("Importer",function(b){b.namespace("JSON_LD",function(b){return b.initInstance=function(b,d,e){var f,g;f={};if(((g=window.jsonld)!=null?g.expand:void 0)==null)throw"Unable to find JSON-LD expand function";e==null&&(e={}),e["http://www.w3.org/1999/02/22-rdf-syntax-ns#type"]="item",d==null&&(d={"http://www.w3.org/2000/01/rdf-schema#":"rdfs","http://www.w3.org/1999/02/22-rdf-syntax-ns#":"rdf","http://www.w3.org/2003/12/exif/ns#":"exif","http://purl.org/dc/elements/1.1/":"dc","http://purl.org/dc/dcmitype/":"dctypes"}),f["import"]=function(f,g){return jsonld.expand(f,{keepFreeFloatingNodes:!0},function(f,h){if(f!=null)g([]);else return jsonld.flatten(h,null,{},function(f,h){var i,j,k;j=[],i=[],k=a.initSynchronizer(),k.process(h,function(a){var b,c,f,g,h,k,l,m,n,o,p,q,r;b={id:a["@id"]};for(h in a){g=a[h],n=[];if(e[h]==="item")for(o=0,q=g.length;o<q;o++){f=g[o];if(f["@id"]!=null){m=f["@id"];for(c in d)l=d[c],m.slice(0,c.length)===c&&(m=l+m.slice(c.length));n.push(m)}}else for(p=0,r=g.length;p<r;p++)f=g[p],f["@value"]!=null?n.push(f["@value"]):f["@id"]!=null&&(f["@id"].slice(0,1)==="("&&f["@id"].slice(-1)===")"?n.push("_:"+f["@id"].slice(1,-1)):n.push(f["@id"]));if(n.length>0){k=h;for(c in d)l=d[c],h.slice(0,c.length)===c&&(k=l+h.slice(c.length));b[k]=n,h==="http://www.w3.org/1999/02/22-rdf-syntax-ns#type"&&(b.type=n)}}if(b.type==null||b.type.length===0)b.type="Blank";j.push(b);return i.push(b.id)});return k.done(function(){var a;a=function(){var a,c,d;for(c=0,d=j.length;c<d;c++)a=j[c],b.contains(a.id)?b.updateItems([a]):b.loadItems([a]);if(g!=null)return g(i)};return c.config.noTimeouts?a():setTimeout(a,0)})})})};return f}});return b.namespace("RDF_JSON",function(b){return b.initInstance=function(b,d,e){var f;f={},e==null&&(e={}),e["http://www.w3.org/1999/02/22-rdf-syntax-ns#type"]==null&&(e["http://www.w3.org/1999/02/22-rdf-syntax-ns#type"]="item"),d==null&&(d={"http://www.w3.org/2000/01/rdf-schema#":"rdfs","http://www.w3.org/1999/02/22-rdf-syntax-ns#":"rdf","http://www.w3.org/2003/12/exif/ns#":"exif","http://purl.org/dc/elements/1.1/":"dc","http://purl.org/dc/dcmitype/":"dctypes"}),f["import"]=function(f,g){var h,i,j,k,l;i=[],h=[],l=a.initSynchronizer(),k=function(){var a;a=[];for(j in f)a.push(j);return a}(),l.process(k,function(a){var b,c,g,j,k,l,m,n,o,p,q,r,s,t;m=f[a],b={id:a};for(k in m){j=m[k],p=[];if(e[k]==="item")for(q=0,s=j.length;q<s;q++){g=j[q];if(g.type==="uri"){o=g.value;for(c in d)n=d[c],g.value.slice(0,c.length)===c&&(o=n+g.value.substr(c.length));p.push(o)}}else for(r=0,t=j.length;r<t;r++){g=j[r];switch(g.type){case"literal":p.push(g.value);break;case"uri":case"bnode":g.value.substr(0,1)==="("&&g.value.subtr(-1)===")"?p.push("_:"+g.value.substr(1,g.value.length-2)):p.push(g.value)}}if(p.length>0){l=k;for(c in d)n=d[c],k.substr(0,c.length)===c&&(l=n+k.substr(c.length));b[l]=p,k==="http://www.w3.org/1999/02/22-rdf-syntax-ns#type"&&(b.type=p)}}if(b.type==null||b.type.length===0)b.type="Blank";i.push(b);return h.push(b.id)});return l.done(function(){var a;a=function(){var a,c,d;for(c=0,d=i.length;c<d;c++)a=i[c],b.contains(a.id)?b.updateItems([a]):b.loadItems([a]);if(g!=null)return g(h)};return c.config.noTimeouts?a():setTimeout(a,0)})};return f}})}),c.namespace("Expression.Basic",function(d){var e,g;e={},g={"+":{argumentType:"number",valueType:"number",f:function(a,b){return a+b}},"-":{argumentType:"number",valueType:"number",f:function(a,b){return a-b}},"*":{argumentType:"number",valueType:"number",f:function(a,b){return a*b}},"/":{argumentType:"number",valueType:"number",f:function(a,b){return a/b}},"=":{valueType:"boolean",f:function(a,b){return a===b}},"<>":{valueType:"boolean",f:function(a,b){return a!==b}},"><":{valueType:"boolean",f:function(a,b){return a!==b}},"<":{valueType:"boolean",f:function(a,b){return a<b}},">":{valueType:"boolean",f:function(a,b){return a>b}},"<=":{valueType:"boolean",f:function(a,b){return a<=b}},">=":{valueType:"boolean",f:function(a,b){return a>=b}}},e.controls=d.controls={"if":{f:function(a,b,c,d,e){var f,g;g=a[0].evaluate(b,c,d,e),f=!1,g.forEachValue(function(a){if(a){f=!0;return!0}return void 0});return f?a[1].evaluate(b,c,d,e):a[2].evaluate(b,c,d,e)}},foreach:{f:function(a,b,c,d,f){var g,h,i,j,k;g=a[0].evaluate(b,c,d,f),h=b.value,i=c.value,j=[],k="text",c.value=g.valueType,g.forEachValue(function(e){var g;b.value=e,g=a[1].evaluate(b,c,d,f),k=g.valueType;return g.forEachValue(function(a){return j.push(a)})}),b.value=h,c.value=i;return e.initCollection(j,k)}},"default":{f:function(a,b,c,d,f){var g,h,i,j;for(i=0,j=a.length;i<j;i++){g=a[i],h=g.evaluate(b,c,d,f);if(h.size()>0)return h}return e.initCollection([],"text")}}},e.initExpression=function(a){var b;b={},b.evaluate=function(b,c,d,e){var f;f=a.evaluate(b,c,d,e);return{values:f.getSet(),valueType:f.valueType,size:f.size}},b.evaluateOnItem=function(a,c){return b.evaluate({value:a},{value:"item"},"value",c)},b.evaluateSingle=function(b,c,d,e){var f,g;f=a.evaluate
(b,c,d,e),g={value:null,valueType:f.valueType},f.forEachValue(function(a){g.value=a;return!0});return g},b.isPath=a.isPath,b.isPath?(b.getPath=function(){return a},b.testExists=function(b,c,d,e){return a.testExists(b,c,d,e)}):(b.getPath=function(){return null},b.testExists=function(a,c,d,e){return b.evaluate(a,c,d,e).values.size()>0}),b.evaluateBackward=function(b,c,d,e){return a.walkBackward([b],c,d,e)},b.walkForward=function(b,c,d){return a.walkForward(b,c,d)},b.walkBackward=function(b,c,d,e){return a.walkBackward(b,c,d,e)};return b},e.initCollection=d.initCollection=function(a,b){var d;d={valueType:b},a instanceof Array?(d.forEachValue=function(b){var c,d,e,f;f=[];for(d=0,e=a.length;d<e;d++){c=a[d];if(b(c)===!0)break;f.push(void 0)}return f},d.getSet=function(){return c.Data.Set.initInstance(a)},d.contains=function(b){return f.call(a,b)>=0},d.size=function(){return a.length}):(d.forEachValue=a.visit,d.size=a.size,d.getSet=function(){return a},d.contains=a.contains),d.isPath=!1;return d},e.initConstant=function(a,b){var c;c={},c.evaluate=function(c,d,f,g){return e.initCollection([a],b)},c.isPath=!1;return c},e.initOperator=function(a,b){var c,d,f;c={},f=a,d=b,c.evaluate=function(c,h,i,j){var k,l,m,n,o;m=[],b=[];for(n=0,o=d.length;n<o;n++)k=d[n],b.push(k.evaluate(c,h,i,j));a=g[f],l=a.f,a.argumentType==="number"?b[0].forEachValue(function(a){typeof a!="number"&&(a=parseFloat(a));return b[1].forEachValue(function(b){typeof b!="number"&&(b=parseFloat(b));return m.push(l(a,b))})}):b[0].forEachValue(function(a){return b[1].forEachValue(function(b){return m.push(l(a,b))})});return e.initCollection(m,a.valueType)},c.isPath=!1;return c},e.initFunctionCall=function(a,b){var c,d;c={},d=b,c.evaluate=function(c,f,g,h){var i,j,k,l;b=[];for(j=0,k=d.length;j<k;j++)i=d[j],b.push(i.evaluate(c,f,g,h));if(((l=e.functions[a])!=null?l.f:void 0)!=null)return e.functions[a].f(b);throw new Error("No such function named "+_name)},c.isPath=!1;return c},e.initControlCall=function(a,b){var c;c={},c.evaluate=function(c,d,f,g){return e.controls[a].f(b,c,d,f,g)},c.isPath=!1;return c},e.initPath=function(a,d){var f,g,h,i,j;f={},i=null,j=[],h=function(b,c){var d,f,g,h,i,k,l,m,n;g=function(a){var d;d=[],b.forEachValue(function(b){return c.getObjects(b,a.property).visit(function(a){return d.push(a)})});return d},f=function(a){var d;d=[],b.forEachValue(function(b){return c.getSubjects(b,a.property).visit(function(a){return d.push(a)})});return d};for(h=m=0,n=j.length;0<=n?m<n:m>n;h=0<=n?++m:--m)i=j[h],i.expression!=null?i.forward&&(b=i.expression.evaluateOnItem(b.getSet().items(),c)):i.isMultiple?(d=[],i.forward?(d=g(i),a=c.getProperty(i.property),k=a!=null?a.getValueType():"text"):(d=f(i),k="item"),b=e.initCollection(d,k)):i.forward?(l=c.getObjectsUnion(b.getSet(),i.property),a=c.getProperty(i.property),k=a!=null?a.getValueType():"text",b=e.initCollection(l,k)):(l=c.getSubjectsUnion(b.getSet(),i.property),b=e.initCollection(l,"item"));return b},g=function(b,d,f){var g,h,i,k,l,m,n,o,p;i=function(a){var c;c=[],b.forEachValue(function(b){return f.getSubjects(b,a.property).visit(function(a){if(k>0||d==null||d.contains(a))return c.push(a)})});return c},h=function(a){var c;c=[],b.forEachValue(function(b){return f.getObjects(b,a.property).visit(function(a){if(k>0||d==null||d.contains(a))return c.push(a)})});return c},d instanceof Array&&(d=c.Data.Set.initInstance(d));for(k=o=p=j.length-1;p<=0?o<=0:o>=0;k=p<=0?++o:--o)l=j[k],l.isMultiple?(g=[],l.forward?(g=i(l),a=f.getProperty(l.property),m=a!=null?a.getValueType():"text"):(g=h(l),m="item"),b=e.initCollection(g,m)):l.forward?(n=f.getSubjectsUnion(b.getSet(),l.property,null,k===0?d:null),b=e.initCollection(n,"item")):(n=f.getObjectsUnion(b.getSet(),l.property,null,k===0?d:null),a=f.getProperty(l.property),m=a!=null?a.getValueType():"text",b=e.initCollection(n,m));return b},a!=null&&j.push({property:a,forward:d,isMultiple:!1}),f.isPath=!0,f.setRootName=function(a){return i=a},f.appendSegment=function(a,b){return j.push({property:a,forward:b[0]===".",isMultiple:b.length>1})},f.getSegment=function(a){var b;if(a<j.length){b=j[a];return{property:b.property,forward:b.forward,isMultiple:b.isMultiple}}return null},f.appendSubPath=function(a){return j.push({expression:a,forward:!0,isMultiple:!0})},f.getLastSegment=function(){return f.getSegment(j.length-1)},f.getSegmentCount=function(){return j.length},f.rangeBackward=function(b,d,e,f){var g,h,i,k,l,m;i=c.Data.Set.initInstance(),k="item";if(j.length>0){h=j[j.length-1];if(h.forward)f.getSubjectsInRange(h.property,b,d,!1,i,j.length===1?e:null);else throw new Error("Last path of segment must be forward");for(g=l=m=j.length-2;m<=0?l<=0:l>=0;g=m<=0?++l:--l)h=j[g],h.forward?(i=f.getSubjectsUnion(i,h.property,null,g===0?e:null),k="item"):(i=f.getObjectsUnion(i,h.property,null,g===0?e:null),a=f.getPropertysegment.property,k=a!=null?a.getValueType():"text")}return{valueType:k,values:i,count:i.size()}},f.evaluate=function(a,c,d,f){var g,j,k,l;k=i!=null?i:d,l=c[k]!=null?c[k]:"text",g=null;if(a[k]!=null){j=a[k],b.isPlainObject(j)||j instanceof Array?g=e.initCollection(j,l):g=e.initCollection([j],l);return h(g,f)}throw new Error("No such variable called "+k)},f.testExists=function(a,b,c,d){return f.evaluate(a,b,c,d).size()>0},f.evaluateBackward=function(a,b,c,d){var f;f=e.initCollection([a],b);return g(f,c,d)},f.walkForward=function(a,b,c){return h(e.initCollection(a,b),c)},f.walkBackward=function(a,b,c,d){return g(e.initCollection(a,b),c,d)};return f},e.initClosure=function(c){var d;d={},d.isPath=!1,b.isArray(c)||(c=[c]),d.evaluateOnItem=function(b,d){var e,f,g,h,i,j,k,l,m,n;f=a.Data.Set.initInstance(),j=null;for(k=0,m=c.length;k<m;k++)e=c[k],i=e.evaluate({value:b},{value:"item"},"value",d),i.getSet().visit(f.add),j==null&&(j=i.valueType);g=f.items();while(g.length>0){h=a.Data.Set.initInstance();for(l=0,n=c.length;l<n;l++)e=c[l],i=e.evaluate({value:g},{value:"item"},"value",d),i.getSet().visit(function(a){if(!f.contains(a)){h.add(a);return f.add(a)}});g=h.items()}return{values:f,getSet:function(){return f},valueType:j||"text",size:f.size()}};return d},e.initExpressionSet=function(c){var d;d={},d.isPath=!1,b.isArray(c)||(c=[c]);return d.evaluateOnItem=function(b,d){var e,f,g,h,i,j;f=a.Data.Set.initInstance(),h=null;for(i=0,j=c.length;i<j;i++)e=c[i],g=e.evaluate({value:roots},{value:"item"},"value",d),g.getSet().visit(finalSet.add),h==null&&(h=g.valueType);return{values:finalSet,getSet:function(){return finalSet},valueType:h||"text",size:finalSet.size()}}},e.initParser=d.initInstance=function(){var a,b;b={},a=function(a,b){var c,d,f,g,h,i,j,k,l,m,n,o,p;n=a.token(),c=e.initScanner,g=function(){a.next();return n=a.token()},i=function(){var a;a=[h()];while(n!=null&&n.type===c.DELIMITER&&n.value===",")g(),a.push(h());return a},f=function(){return n!=null?n.start:a.index()},j=function(){var a,b,d;d=e.initPath();while(n!=null&&n.type!==c.OPERATOR&&(n.type!==c.DELIMITER||n.value!==")"))if(n.type===c.PATH_OPERATOR){b=n.value,g();if(n!=null&&n.type===c.IDENTIFIER)d.appendSegment(n.value,b),g();else throw new Error("Missing property ID at position "+f())}else if(n.type===c.DELIMITER&&n.value==="("){g(),a=i();if(!n||n.type!==c.DELIMITER)throw new Error("Mismatched ')' at position "+f());if(n.value===")")g(),n&&n.type===c.OPERATOR&&n.value==="*"?(g(),d.appendSubPath(e.initClosure(a))):d.appendSubPath(e.initExpressionSet(a));else throw new Error("Mismatched ')' at position "+f())}return d},k=function(){var a,b,d;d=null,a=[];if(n==null)throw new Error("Missing factor at end of expression");switch(n.type){case c.OPERATOR:return d;case c.NUMBER:d=e.initConstant(n.value,"number"),g();break;case c.STRING:d=e.initConstant(n.value,"text"),g();break;case c.PATH_OPERATOR:d=j();break;case c.IDENTIFIER:b=n.value,g();if(e.controls[b]!=null){if(n==null||n.type!==c.DELIMITER||n.value!=="(")throw new Error("Missing ( to start "+b+" at position "+f());g(),n!=null&&n.type===c.DELIMITER&&n.value===")"?a=[]:a=i(),d=e.initControlCall(b,a);if(n!=null&&n.type===c.DELIMITER&&n.value===")")g();else throw new Error("Missing ) to end "+b+" at position "+f())}else if(n!=null&&n.type===c.DELIMITER&&n.value==="("){g(),n!=null&&n.type===c.DELIMITER&&n.value===")"?a=[]:a=i(),d=e.initFunctionCall(b,a);if(n!=null&&n.type===c.DELIMITER&&n.value===")")g();else throw new Error("Missing ) after function call "+b+" at position "+f())}else d=j(),d.setRootName(b);break;case c.DELIMITER:if(n.value!=="(")throw new Error("Unexpected text "+n.value+" at position "+f());g(),d=h();if(n!=null&&n.type===c.DELIMITER&&n.value===")")g();else throw new Error("Missing ) at position "+f());break;default:throw new Error("Unexpected text "+n.value+" at position "+f())}return d},h=function(){var a,b,d;a=k();while((n!=null?n.type:void 0)===c.OPERATOR&&((d=n.value)==="="||d==="<"||d===">"||d==="<>"||d==="<="||d===">="))b=n.value,g(),a=e.initOperator(b,[a,k()]);return a};if(b){m=i(),d=[];for(o=0,p=m.length;o<p;o++)l=m[o],d.push(e.initExpression(l));return d}return[e.initExpression(h())]},b.parse=function(b,c,d){var f;c==null&&(c=0),d==null&&(d={}),f=e.initScanner(b,c);try{return a(f,!1)[0]}finally{d.index=f.token()!=null?f.token().start:f.index()}};return b},e.initScanner=function(a,b){var c,d,f,g,h,i;d={},h=a+" ",g=a.length,f=b,i=null,c=function(a){return"0123456789".indexOf(a)>=0},d.token=function(){return i},d.index=function(){return f},d.next=function(){var a,b,d,j,k;i=null;while(f<g&&" \t\r\n".indexOf(h[f])>=0)f+=1;if(f<g){b=h.charAt(f),d=h.charAt(f+1),j=h.charAt(f+2);if(".!".indexOf(b)<0){if(b==="<"&&d==="-"){if(j==="@"){i={type:e.initScanner.PATH_OPERATOR,value:"!@",start:f,end:f+3};return f+=3}i={type:e.initScanner.PATH_OPERATOR,value:"!",start:f,end:f+2};return f+=2}if(b==="-"&&d===">"){if(j==="@"){i={type:e.initScanner.PATH_OPERATOR,value:".@",start:f,end:f+3};return f+=3}i={type:e.initScanner.PATH_OPERATOR,value:".",start:f,end:f+2};return f+=2}if("<>".indexOf(b)<0){if("+-*/=".indexOf(b)<0){if("()".indexOf(b)<0){if("\"'".indexOf(b)<0){if(c(b)){k=f;while(k<g&&c(h.charAt(k)))k+=1;if(k<g&&h.charAt(k)==="."){k+=1;while(k<g&&c(h.charAt(k)))k+=1}i={type:e.initScanner.NUMBER,value:parseFloat(h.substring(f,k)),start:f,end:k};return f=k}k=f;while(k<g){a=h.charAt(k);if("(),.!@ \t".indexOf(a)>=0)break;k+=1}i={type:e.initScanner.IDENTIFIER,value:h.substring(f,k),start:f,end:k};return f=k}k=f+1;while(k<g){if(h.charAt(k)===b&&h.charAt(k-1)!=="\\")break;k+=1}if(k<g){i={type:e.initScanner.STRING,value:h.substring(f+1,k).replace(/\\'/g,"'").replace(/\\"/g,'"'),start:f,end:k+1};return f=k+1}throw new Error("Unterminated string starting at "+String(f))}i={type:e.initScanner.DELIMITER,value:b,start:f,end:f+1};return f+=1}i={type:e.initScanner.OPERATOR,value:b,start:f,end:f+1};return f+=1}if(d==="="||"<>".indexOf(d)>=0&&b!==d){i={type:e.initScanner.OPERATOR,value:b+d,start:f,end:f+2};return f+=2}i={type:e.initScanner.OPERATOR,value:b,start:f,end:f+1};return f+=1}if(d==="@"){i={type:e.initScanner.PATH_OPERATOR,value:b+d,start:f,end:f+2};return f+=2}i={type:e.initScanner.PATH_OPERATOR,value:b,start:f,end:f+1};return f+=1}},d.next();return d},e.initScanner.DELIMITER=0,e.initScanner.NUMBER=1,e.initScanner.STRING=2,e.initScanner.IDENTIFIER=3,e.initScanner.OPERATOR=4,e.initScanner.PATH_OPERATOR=5,e.functions={},e.FunctionUtilities={};return d.registerSimpleMappingFunction=function(a,b,d){return e.functions[a]={f:function(a){var f,g,h,i,j;h=c.Data.Set.initInstance(),g=function(a){return a.forEachValue(function(a){var c;c=b(a);if(c!=null)return h.add(c)})};for(i=0,j=a.length;i<j;i++)f=a[i],g(f);return e.initCollection(h,d)}}}}),c.namespace("Presentation",function(a){a.initInstance=function(){var a;a=1<=arguments.length?e.call(arguments,0):[];return c.initInstance.apply(c,["MITHgrid.Presentation"].concat(e.call(a),[function(a,d){var e,f,g,h,i;e=null,i={},g=a.options.lenses||{},h=a.options,b(d).empty(),f=void 0,h.lensKey||(h.lensKey=[".type"]),a.getLens=function(a){var b,c;f!=null&&(c=f.evaluate([a]),b=c[0]);if(b!=null&&g[b]!=null)return{render:g[b]}},a.addLens=function(b,c){g[b]=c;return a.selfRender()},a.removeLens=function(a){return delete g[a]},a.hasLens=function(a){return g[a]!=null},a.visitRenderings=function(a){var b,c;for(b in i){c=i[b];if(!1===a(b,c))return}},a.renderingFor=function(a){return i[a]},a.renderItems=function(b,g){var j,k,l;f==null&&(f=b.prepare(h.lensKey)),k=g.length,l=k,l>200&&(l=parseInt(Math.sqrt(l),10)+1),l<1&&(l=1),j=function(f){var h,m,o,p,q,r;if(f<k){h=f+l;if(h>k||c.config.noTimeouts)h=k;for(o=r=f;f<=h?r<h:r>h;o=f<=h?++r:--r)p=g[o],m=b.contains(p)&&a.hasLensFor(p),i[p]!=null?m?i[p].update(b.getItem(p)):(e===p&&i[p].eventUnfocus!=null&&i[p].eventUnfocus(),i[p].remove!=null&&i[p].remove(),delete i[p]):m&&(q=a.render(d,b,p),q!=null&&(i[p]=q,e===p&&q.eventFocus!=null&&q.eventFocus()));return setTimeout(function(){return j(h)},0)}if(a.finishDisplayUpdate!=null)return a.finishDisplayUpdate()},a.startDisplayUpdate();return j(0)},a.render=function(b,c,d){var e;e=a.getLens(d);if(e!=null)return e.render(b,a,c,d)},a.hasLensFor=function(b){var c;c=a.getLens(b);return c!=null},a.eventModelChange=a.renderItems,a.startDisplayUpdate=function(){},a.finishDisplayUpdate=function(){},a.selfRender=function(){return a.renderItems(a.dataView,a.dataView.items())},a.eventFocusChange=function(b){var c;e!=null&&(c=a.renderingFor(e)),e!==b&&(c!=null&&c.eventUnfocus!=null&&c.eventUnfocus(),b!=null&&(c=a.renderingFor(b),c!=null&&c.eventFocus!=null&&c.eventFocus()),e=b);return e},a.getFocusedRendering=function(){return e!=null?a.renderingFor(e):null},a.dataView=a.options.dataView;return a.dataView.registerPresentation(a)}]))},a.namespace("SimpleText",function(a){return a.initInstance=function(){var a,b;a=1<=arguments.length?e.call(arguments,0):[];return(b=c.Presentation).initInstance.apply(b,["MITHgrid.Presentation.SimpleText"].concat(e.call(a),[function(a,b){}]))}});return a.namespace("Table",function(a){return a.initInstance=function(){var a,d;a=1<=arguments.length?e.call(arguments,0):[];return(d=c.Presentation).initInstance.apply(d,["MITHgrid.Presentation.Table"].concat(e.call(a),[function(a,c){var d,e,f,g,h,i,j,k;f=a.options,h=b("<table></table>"),e=b("<tr></tr>"),h.append(e),k=f.columns;for(i=0,j=k.length;i<j;i++)d=k[i],e.append("<th>"+f.columnLabels[d]+"</th>");b(c).append(h),a.hasLensFor=function(){return!0},g=function(a){var b,c;a!=null?(a=[].concat(a),a.length>1?(b=a.pop(),c=a.join(", "),a.length>1?c=c+", and "+b:c=c(" and "+b)):c=a[0]):c="";return c};return a.render=function(a,c,e){var i,j,k,l,m,n,o,p,q;j={},n={},k=b("<tr></tr>"),n.el=k,m=c.getItem(e),l=!0,q=f.columns;for(o=0,p=q.length;o<p;o++)d=q[o],i=b("<td></td>"),m[d]!=null&&(i.text(g(m[d])),l=!1,j[d]=i),k.append(i);if(!l){h.append(k),n.update=function(a){var b,c,e,h;e=f.columns,h=[];for(b=0,c=e.length;b<c;b++)d=e[b],a[d]!=null?h.push(j[d].text(g(a[d]))):h.push(void 0);return h},n.remove=function(){k.hide();return k.remove()};return n}k.remove();return null}}]))}})}),c.namespace("Facet",function(a){a.initInstance=function(){var a;a=1<=arguments.length?e.call(arguments,0):[];return c.initInstance.apply(c,["MITHgrid.Facet"].concat(e.call(a),[function(a,c){var d;d=a.options,a.selfRender=function(){},a.eventFilterItem=function(a,b){return!1},a.eventModelChange=function(a,b){},a.constructFacetFrame=function(a,c){var d;d={},b(a).addClass("mithgrid-facet"),d.header=b("<div class='header' />"),c.onClearAllSelections!=null&&(d.controls=b("<div class='control' title='Clear Selection'>"),d.counter=b("<span class='counter'></span>"),d.controls.append(d.counter),d.header.append(d.controls)),d.title=b("<span class='title'></span>"),d.title.text(c.facetLabel||""),d.header.append(d.title),d.bodyFrame=b("<div class='body-frame'></div>"),d.body=b("<div class='body'></div>"),d.bodyFrame.append(d.body),b(a).append(d.header),b(a).append(d.bodyFrame),c.onClearAllSelections!=null&&d.controls.bind("click",c.onClearAllSelections),d.setSelectionCount=function(a){d.counter.innerHTML=a;return a>0?d.counter.show():d.counter.hide()};return d};return d.dataView.registerFilter(a)}]))},a.namespace("TextSearch",function(d){return d.initInstance=function(){var d;d=1<=arguments.length?e.call(arguments,0):[];return a.initInstance.apply(a,["MITHgrid.Facet.TextSearch"].concat(e.call(d),[function(a){var d,e,f,g;e=a.options,e.expressions!=null&&(b.isArray(e.expressions)||(e.expressions=[e.expressions]),g=c.Expression.Basic.initInstance(),f=function(){var a,b,c,f;c=e.expressions,f=[];for(a=0,b=c.length;a<b;a++)d=c[a],f.push(g.parse(d));return f}()),a.eventFilterItem=function(b,c){var g,h,i,j,k,l,m;if(a.text!=null&&e.expressions!=null)for(i=0,k=f.length;i<k;i++){d=f[i],g=d.evaluateOnItem(c,b),m=g.values.items();for(j=0,l=m.length;j<l;j++){h=m[j];if(h.toLowerCase().indexOf(a.text)>=0)return}}return!1},a.eventModelChange=function(a,b){};return a.selfRender=function(){var c,d;c=a.constructFacetFrame(container,null,{facetLabel:e.facetLabel}),b(container).addClass("mithgrid-facet-textsearch"),d=b("<input type='text'>"),c.body.append(d);return d.keyup(function(){a.text=b.trim(d.val().toLowerCase());return a.events.onFilterChange.fire()})}}]))}}),a.namespace("List",function(d){return d.initInstance=function(){var d;d=1<=arguments.length?e.call(arguments,0):[];return a.initInstance.apply(a,["MITHgrid.Facet.List"].concat(e.call(d),[function(a){var d,e,g,h;e=a.options,a.selections=[],e.expressions!=null&&(b.isArray(e.expressions)||(e.expressions=[e.expressions]),h=c.Expression.Basic.initInstance(),g=function(){var a,b,c,f;c=e.expressions,f=[];for(a=0,b=c.length;a<b;a++)d=c[a],f.push(h.parse(d));return f}()),a.eventFilterItem=function(b,c){var h,i,j,k,l,m,n;if(a.text!=null&&e.expressions!=null)for(j=0,l=g.length;j<l;j++){d=g[j],h=d.evaluateOnItem(c,b),n=h.values.items();for(k=0,m=n.length;k<m;k++){i=n[k];if(f.call(a.selections,i)>=0)return}}};return a.selfRender=function(){var b;return b=a.constructFacetFrame(container,null,{facetLabel:e.facetLabel,resizable:!0})}}]))}});return a.namespace("Range",function(c){return c.initInstance=function(){var c;c=1<=arguments.length?e.call(arguments,0):[];return a.initInstance.apply(a,["MITHgrid.Facet.Range"].concat(e.call(c),[function(a){var c;c=a.options,c.min==null&&(c.min=0),c.max==null&&(c.max=100),c.step==null&&(c.step=1/30);return a.selfRender=function(){var d,e;d=a.constructFacetFrame(container,null,{facetLabel:c.facetLabel,resizable:!1}),e=b("<input type='range'>"),e.attr({min:c.min,max:c.max,step:c.step}),d.body.append(e);return e.event(function(){a.value=e.val();return a.events.onFilterChange.fire()})}}]))}})}),c.namespace("Controller",function(a){a.initInstance=function(){var a;a=1<=arguments.length?e.call(arguments,0):[];return c.initInstance.apply(c,["MITHgrid.Controller"].concat(e.call(a),[function(a){var d,f;d=a.options,d.selectors==null&&(d.selectors={}),(f=d.selectors)[""]==null&&(f[""]=""),a.initBind=function(a){return c.initInstance(d.bind,function(c){var e;e={"":b(a)},c.locate=function(c){var f,g;g=d.selectors[c];if(g!=null){g===""?f=b(a):f=b(a).find(g),e[g]=f;return f}return void 0},c.fastLocate=function(a){var b;b=d.selectors[a];if(b!=null){if(e[b]!=null)return e[b];return c.locate(a)}return void 0},c.refresh=function(c){var f,g,h,i;for(h=0,i=c.length;h<i;h++)f=c[h],g=d.selectors[f],g!=null&&(g===""?e[""]=b(a):e[g]=b(a).find(g));return void 0};return c.clearCache=function(){return e={"":b(a)}}})},a.bind=function(){var b,c,d;d=arguments[0],b=2<=arguments.length?e.call(arguments,1):[],c=a.initBind(d),a.applyBindings.apply(a,[c].concat(e.call(b))),c.unbind=function(){return a.removeBindings.apply(a,[c].concat(e.call(b)))};return c},a.applyBindings=function(){var a,b;b=arguments[0],a=2<=arguments.length?e.call(arguments,1):[]};return a.removeBindings=function(){var a,b;b=arguments[0],a=2<=arguments.length?e.call(arguments,1):[]}}]))};return a.namespace("Raphael",function(a){return a.initInstance=function(){var a,b;a=1<=arguments.length?e.call(arguments,0):[];return(b=c.Controller).initInstance.apply(b,["MITHgrid.Controller.Raphael"].concat(e.call(a),[function(a){var b;b=a.initBind;return a.initBind=function(a){var c,d,e,f,g;c=b(a.node),f=c.locate,e=c.fastLocate,g=c.refresh,d=c.bind,c.locate=function(b){return b==="raphael"?a:f(b)},c.fastLocate=function(b){return b==="raphael"?a:e(b)},c.refresh=function(a){var b;a=function(){var c,d,e;e=[];for(c=0,d=a.length;c<d;c++)b=a[c],b!=="raphael"&&e.push(b);return e}();return g(a)};return c}}]))}})}),c.namespace("Application",function(a){return a.initInstance=function(){var a;a=1<=arguments.length?e.call(arguments,0):[];return c.initInstance.apply(c,["MITHgrid.Application"].concat(e.call(a),[function(a,d){var e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w,x,y,z,A;j=[],o=function(){return a},a.presentation={},a.facet={},a.component={},a.dataStore={},a.dataView={},a.controller={},k=a.options,a.ready=function(a){return j.push(a)},a.run=function(){return b(document).ready(function(){var b,c,d;a.ready=function(a){return a()};for(c=0,d=j.length;c<d;c++)b=j[c],b();return j=[]})},a.addDataStore=function(b,d){var e,f,g,h,i,j,k,l;a.dataStore[b]==null?(g=c.Data.Store.initInstance(),a.dataStore[b]=g,g.addType("Item"),g.addProperty("type",{valueType:"text"}),g.addProperty("id",{valueType:"text"})):g=a.dataStore[b];if((d!=null?d.types:void 0)!=null){j=d.types;for(h in j)i=j[h],g.addType(h)}if((d!=null?d.properties:void 0)!=null){k=d.properties,l=[];for(e in k)f=k[e],l.push(g.addProperty(e,f));return l}},a.addDataView=function(b,d){var e,f,g,h,i;d.type!=null&&d.type.initInstance!=null?e=d.type.initInstance:e=c.Data.View.initInstance,i={dataStore:a.dataStore[d.dataStore]||a.dataView[d.dataStore]};if(a.dataView[b]==null){for(f in d)g=d[f],f!=="type"&&!i[f]&&(i[f]=g);h=e(i);return a.dataView[b]=h}},a.addController=function(c,d){var e,f;f=b.extend(!0,{},d),f.application=o,e=d.type.initInstance(f);return a.controller[c]=e},a.addFacet=function(c,e){var f;f=b.extend(!0,{},e);return a.ready(function(){var g,h;h=b(d).find(e.container),b.isArray(h)&&(h=h[0]),f.dataView=a.dataView[e.dataView],f.application=o,g=e.type.initInstance(h,f),a.facet[c]=g;return g.selfRender()})},a.addComponent=function(c,e){var f;f=b.extend(!0,{},e);return a.ready(function(){var g,h,i,j,k;h=b(d).find(f.container),b.isArray(h)&&(h=h[0]),f.application=o;if(e.components!=null){f.components={},j=e.components;for(g in j)e=j[g],typeof e=="string"?f.components[g]=a.component[g]:(i=b.extend(!0,{},ccconfig),i.application=o,f.components[g]=e.type.initInstance(i))}if(e.controllers!=null){f.controllers={},k=m.controllers;for(g in k)e=k[g],typeof e=="string"?f.controllers[g]=a.controller[g]:(i=b.extend(!0,{},ccconfig),i.application=o,f.controllers[g]=e.type.initInstance(i))}return a.component[c]=e.type.initInstance(h,f)})},a.addPresentation=function(c,e){var f;f=b.extend(!0,{},e);return a.ready(function(){var g,h,i,j,k,l,m,n,p;l=b(d).find(f.container),b.isArray(l)&&(l=l[0]),f.dataView=a.dataView[e.dataView],f.application=o;if(e.components!=null){f.components={},n=e.components;for(h in n)i=n[h],typeof i=="string"?f.components[h]=a.component[h]:(j=b.extend(!0,{},ccconfig),j.application=o,f.components[h]=i.type.initInstance(j))}if(e.controllers!=null){f.controllers={},p=e.controllers;for(g in p)i=p[g],typeof i=="string"?f.controllers[g]=a.controller[g]:(k=b.extend(!0,{},i),k.application=o,f.controllers[g]=i.type.initInstance(k))}m=e.type.initInstance(l,f),a.presentation[c]=m;return m.selfRender()})},a.addPlugin=function(c){var e,f,g,h,i,j,k,l,m,n,p,q;e=b.extend(!0,{},c),e.application=o,f=e.type.initInstance(e);if(f!=null){if((e!=null?e.dataView:void 0)!=null){f.dataView=a.dataView[e.dataView],m=f.getTypes();for(k in m)l=m[k],f.dataView.addType(k);n=f.getProperties();for(i in n)j=n[i],f.dataView.addProperty(i,j)}p=f.getPresentations(),q=[];for(g in p)h=p[g],q.push(function(c,g){return a.ready(function(){var h,i,j;j=b.extend(!0,{},g.options),h=b(d).find(g.container),b.isArray(h)&&(h=h[0]),(g!=null?g.lenses:void 0)!=null&&(j.lenses=g.lenses),g.dataView!=null?j.dataView=a.dataView[g.dataView]:e.dataView!=null&&(j.dataView=a.dataView[e.dataView]),j.application=o,i=g.type.initInstance(h,j),f.presentation[c]=i;return i.selfRender()})});return q}};if((k!=null?k.dataStores:void 0)!=null){t=k.dataStores;for(n in t)g=t[n],a.addDataStore(n,g)}if((k!=null?k.dataViews:void 0)!=null){u=k.dataViews;for(q in u)p=u[q],a.addDataView(q,p)}if((k!=null?k.controllers:void 0)!=null){v=k.controllers;for(e in v)f=v[e],a.addController(e,f)}if((k!=null?k.facets:void 0)!=null){w=k.facets;for(h in w)i=w[h],a.addFacet(h,i)}if((k!=null?k.components:void 0)!=null){x=k.components;for(e in x)f=x[e],a.addComponent(e,f)}if((k!=null?k.presentations:void 0)!=null){y=k.presentations;for(l in y)m=y[l],a.addPresentation(l,m)}if((k!=null?k.plugins:void 0)!=null){z=k.plugins,A=[];for(r=0,s=z.length;r<s;r++)m=z[r],A.push(a.addPlugin(m));return A}}]))}}),c.namespace("Plugin",function(a){return a.initInstance=function(a,b){var c,d;d={options:b,presentation:{}},c=[],d.getTypes=function(){return(b!=null?b.types:void 0)!=null?b.types:[]},d.getProperties=function(){return(b!=null?b.properties:void 0)!=null?b.properties:[]},d.getComponents=function(){return(b!=null?b.components:void 0)!=null?b.components:[]},d.getPresentations=function(){return(b!=null?b.presentations:void 0)!=null?b.presentations:[]},d.ready=c.push,d.eventReady=function(a){var b,e,f;for(e=0,f=c.length;e<f;e++)b=c[e],b(a);c=[];return d.ready=function(b){return b(a)}};return d}}),c.initView=c.deprecated("MITHgrid.initView",c.initInstance),c.Data.initSet=c.deprecated("MITHgrid.Data.initSet",c.Data.Set.initInstance),c.Data.initType=c.deprecated("MITHgrid.Data.initType",c.Data.Type.initInstance),c.Data.initProperty=c.deprecated("MITHgrid.Data.initProperty",c.Data.Property.initInstance),c.Data.initStore=c.deprecated("MITHgrid.Data.initStore",c.Data.Store.initInstance),c.Data.initView=c.deprecated("MITHgrid.Data.initView",c.Data.View.initInstance),c.Presentation.initPresentation=c.deprecated("MITHgrid.Presentation.initPresentation",c.Presentation.initInstance),c.Presentation.SimpleText.initPresentation=c.deprecated("MITHgrid.Presentation.SimpleText.initPresentation",c.Presentation.SimpleText.initInstance);return c.Application.initApp=c.deprecated("MITHgrid.Application.initApp",c.Application.initInstance)}(c,b),b.defaults("MITHgrid.Data.Store",{events:{onModelChange:null,onBeforeLoading:null,onAfterLoading:null,onBeforeUpdating:null,onAfterUpdating:null}}),b.defaults("MITHgrid.Data.View",{events:{onModelChange:null,onFilterItem:"preventable"}}),b.defaults("MITHgrid.Data.SubSet",{events:{onModelChange:null}}),b.defaults("MITHgrid.Data.Pager",{events:{onModelChange:null}}),b.defaults("MITHgrid.Data.RangePager",{events:{onModelChange:null}}),b.defaults("MITHgrid.Data.ListPager",{events:{onModelChange:null}}),b.defaults("MITHgrid.Facet",{events:{onFilterChange:null}}),b.defaults("MITHgrid.Facet.TextSearch",{facetLabel:"Search",expressions:[".label"]})}).call(this)
;