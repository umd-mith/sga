// Generated by CoffeeScript 1.4.0
/*
 * mithgrid JavaScript Library v0.0.2
 *
 * Date: Wed Dec 12 18:34:21 2012 -0500
 *
 * (c) Copyright University of Maryland 2011-2012.  All rights reserved.
 *
 * (c) Copyright Texas A&M University 2010.  All rights reserved.
 *
 * Portions of this code are copied from The SIMILE Project:
 *  (c) Copyright The SIMILE Project 2006. All rights reserved.
 *
 * Redistribution and use in source and binary forms, with or without
 * modification, are permitted provided that the following conditions
 * are met:
 *
 * 1. Redistributions of source code must retain the above copyright
 *    notice, this list of conditions and the following disclaimer.
 *
 * 2. Redistributions in binary form must reproduce the above copyright
 *    notice, this list of conditions and the following disclaimer in the
 *    documentation and/or other materials provided with the distribution.
 *
 * 3. The name of the author may not be used to endorse or promote products
 *    derived from this software without specific prior written permission.
 *
 * THIS SOFTWARE IS PROVIDED BY THE AUTHOR ``AS IS'' AND ANY EXPRESS OR
 * IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED WARRANTIES
 * OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE DISCLAIMED.
 * IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY DIRECT, INDIRECT,
 * INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT
 * NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE,
 * DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY
 * THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT
 * (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF
 * THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.
*/
(function(){var a,b,c,d,e=[].slice,f=[].indexOf||function(a){for(var b=0,c=this.length;b<c;b++)if(b in this&&this[b]===a)return b;return-1};a=(c=this.MITHGrid)!=null?c:this.MITHGrid={},b=(d=this.jQuery)!=null?d:this.jQuery={},function(a,b){var c,d,g;(typeof console!="undefined"&&console!==null?console.log:void 0)!=null?b.debug=console.log:b.debug=function(){},b.error=function(){b.debug.call({},arguments);return{arguments:arguments}},b.deprecated=function(a,b){return function(){var c;c=1<=arguments.length?e.call(arguments,0):[],console.log("Call to deprecated function "+a+".");return b.apply(null,c)}},b.namespace=function(a,c){return d(b,a,c)},d=function(a,c,e){var f,g;f=c.split(".");while(f.length>1)a[f[0]]||(a=d(a,f[0]),f.shift());a[f[0]]==null&&(g={namespace:function(a,b){return d(g,a,b)},debug:b.debug},a[f[0]]=g),e!=null&&e(a[f[0]]);return a[f[0]]},b.globalNamespace=function(a,c){var e,f,g;e=window,e[a]||(e[a]={}),(f=e[a]).debug||(f.debug=b.debug),(g=e[a]).namespace||(g.namespace=function(b,c){return d(e[a],b,c)}),c!=null&&c(e[a]);return e[a]},b.normalizeArgs=function(){var b,c,d,f,g,h,i,j,k;b=1<=arguments.length?e.call(arguments,0):[],c=[],g=[],i=b.pop();while(a.isFunction(i)||a.isPlainObject(i))a.isFunction(i)?c.push(i):g.push(i),i=b.pop();b.push(i),c.length===0?d=function(){var a;a=1<=arguments.length?e.call(arguments,0):[]}:c.length===1?d=c[0]:d=function(){var a,b,d,f,g;b=1<=arguments.length?e.call(arguments,0):[],g=[];for(d=0,f=c.length;d<f;d++)a=c[d],g.push(a.apply(null,b));return g},g.length===0?h={}:g.length===1?h=g[0]:(g=g.reverse(),h=a.extend.apply(a,[!0,{}].concat(e.call(g)))),j=[];while(typeof b[0]=="string"){if((k=b[0].substr(0,1))==="#"||k===".")break;j.push(b.shift())}j=j.reverse(),a.isArray(b[0])&&(j=j.concat(b.shift())),b.length>0?f=b.pop():f=null;return[j,f,h,d]},c={},b.defaults=function(b,d){c[b]||(c[b]={});return c[b]=a.extend(!0,c[b],d)},b.initSynchronizer=function(a){var b,c,d,e;e={},b=1,c=!1,d=!1,e.increment=function(){return b+=1},e.add=function(a){return b+=a},e.decrement=function(){b-=1,b<=0&&c&&!d&&(d=!0,a!=null&&a());return b},e.done=function(b){c=!0,b!=null&&(a=b);return e.decrement()},e.process=function(a,b){var c,d;c=a.length,e.add(c),d=function(f){var g,h,i;g=f+100,g>c&&(g=c);for(h=i=f;f<=g?i<g:i>g;h=f<=g?++i:--i)b(a[h]),e.decrement();if(g<c)return setTimeout(function(){return d(g)},0)};return setTimeout(function(){return d(0)},0)};return e},b.initEventFirer=function(b,c,d){var f,g,h,i,j,k,l,m,n,o,p;p={isPreventable:!!b,isUnicast:!!c,hasMemory:!!d},g=[],p.isPreventable&&g.push("stopOnFalse"),i=a.Callbacks(g.join(" ")),j=function(){return i.empty()},o=function(a){return i.remove(a)},f=function(a){i.add(a);return function(){return o(a)}},k=function(){var a;a=1<=arguments.length?e.call(arguments,0):[];return i.fire.apply(i,a)},p.isUnicast||p.isPreventable?(h=[],o=function(a){var b;return h=function(){var c,d,e;e=[];for(c=0,d=h.length;c<d;c++)b=h[c],b!==a&&e.push(b);return e}()},f=function(a){h.push(a);return function(){return o(a)}},p.isUnicast&&i.add(function(){var a;a=1<=arguments.length?e.call(arguments,0):[];if(h.length>0)return h[0].apply(h,a)}),p.isPreventable&&(k=function(){var a,b,c,d,f;a=1<=arguments.length?e.call(arguments,0):[];for(d=0,f=h.length;d<f;d++){b=h[d],c=b.apply(null,a);if(c===!1)return!1}return!0}),j=function(){h=[];return i.empty()}):p.hasMemory&&(l=[],m=f,f=function(a){var b,c,d;for(c=0,d=l.length;c<d;c++)b=l[c],a.apply(null,b);return m(a)},n=k,k=function(){var a;a=1<=arguments.length?e.call(arguments,0):[],l.push(a);return n.apply(null,a)},j=function(){l=[];return i.empty()}),p.addListener=f,p.removeListener=o,p.fire=k,p._destroy=j;return p},g=0,b.initInstance=function(){var d,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w,x,y,z,A;d=1<=arguments.length?e.call(arguments,0):[],x=b.normalizeArgs.apply(b,d),n=x[0],l=x[1],k=x[2],j=x[3],s={_mithgrid_type:"MITHGrid"},p=[],s.onDestroy=function(a){return p.push(a)},s._destroy=function(){var a,b,c,d,e,f,g,h,i;g=p.reverse();for(e=0,f=g.length;e<f;e++)j=g[e],j();p=[],h=s.events;for(a in h)c=h[a],c._destroy();i=[];for(b in s)d=s[b],i.push(delete s[b]);return i},r=[];if(n!=null){typeof n=="string"&&(n=[n]),s._mithgrid_type=n[0],n.reverse();for(v=0,w=n.length;v<w;v++){o=n[v],h=o.split("."),o=h.shift(),c[o]!=null&&r.push(c[o]);while(h.length>0)o=o+"."+h.shift(),c[o]!=null&&r.push(c[o])}}k!=null&&r.push(k),q=a.extend.apply(a,[!0,{}].concat(e.call(r))),g+=1,s.id=g,s.options=q,s.container=l,s.events={};if(s.options.events!=null){y=s.options.events;for(m in y)i=y[m],i!=null?typeof i=="string"&&(i=[i]):i=[],s.events[m]=b.initEventFirer(f.call(i,"preventable")>=0,f.call(i,"unicast")>=0,f.call(i,"memory")>=0)}s.addVariable=function(a,c){var d,e,g,h,i,j,k,l,m,n,o,p;p=c["default"],c.is||(c.is="rw"),f.call(c.is,"w")>=0&&(g=c.filter,o=c.validate,e=c.event||"on"+a+"Change",l=c.setter||"set"+a,d=c.adder||"add"+a,i=c.locker||"lock"+a,n=c.unlocker||"unlock"+a,s.events[e]=b.initEventFirer(),g!=null?o!=null?m=function(a){a=o(g(a));if(p!==a){p=a;return s.events[e].fire(p)}}:m=function(a){a=g(a);if(p!==a){p=a;return s.events[e].fire(p)}}:o!=null?m=function(a){a=o(a);if(p!==a){p=a;return s.events[e].fire(p)}}:m=function(a){if(p!==a){p=a;return s.events[e].fire(p)}},f.call(c.is,"l")>=0&&(j=0,s[i]=function(){return j+=1},s[n]=function(){return j-=1},k=m,m=function(a){if(j===0)return k(a)}),s[l]=m,c.isa==="numeric"&&(s[d]=function(a){return m(a+p)}));if(f.call(c.is,"r")>=0){h=c.getter||"get"+a;return s[h]=function(){return p}}};if(((z=s.options)!=null?z.variables:void 0)!=null){A=q.variables;for(t in A)k=A[t],s.addVariable(t,k)}(q!=null?q.viewSetup:void 0)!=null&&l!=null&&(u=q.viewSetup,a.isFunction(u)?a(document).ready(function(){return u(a(l))}):a(document).ready(function(){return a(l).append(u)})),j!=null&&j(s,l);return s},b.namespace("events",function(c){c.onWindowResize=b.initEventFirer(!1,!1);return a(document).ready(function(){return a(window).resize(function(){return setTimeout(b.events.onWindowResize.fire,0)})})}),b.namespace("mouse",function(b){var c;c=[],b.capture=function(b){var d;d=c[0],c.unshift(b),c.length===1&&(a(document).mousemove(function(a){a.preventDefault();return c[0].call(a,"mousemove")}),a(document).mouseup(function(a){a.preventDefault();return c[0].call(a,"mouseup")}));return d};return b.uncapture=function(){var b;b=c.shift(),c.length===0&&(a(document).unbind("mousemove"),a(document).unbind("mouseup"));return b}}),b.namespace("Data",function(c){c.namespace("Set",function(a){return a.initInstance=function(a){var b,c,d,e,f,g,h,i;g={},d={},b=0,f=!0,e=[],g.items=function(){var a;if(f){e=[];for(a in d)typeof a=="string"&&d[a]===!0&&e.push(a)}return e},g.add=function(a){if(d[a]==null){d[a]=!0,f=!0;return b+=1}},g.remove=function(a){if(d[a]!=null){delete d[a],f=!0;return b-=1}},g.empty=function(){d={},b=0,f=!1,e=[];return!1},g.visit=function(a){var b;for(b in d)if(a(b)===!0)break;return!1},g.contains=function(a){return d[a]!=null},g.size=function(){return f?g.items().length:e.length};if(a instanceof Array)for(h=0,i=a.length;h<i;h++)c=a[h],g.add(c);return g}}),c.namespace("Type",function(a){return a.initInstance=function(a){var b;return b={name:a,custom:{}}}}),c.namespace("Property",function(a){return a.initInstance=function(a){var b;return b={name:a,getValueType:function(){var a;return(a=b.valueType)!=null?a:"text"}}}}),c.namespace("Store",function(d){return d.initInstance=function(){var d;d=1<=arguments.length?e.call(arguments,0):[];return b.initInstance.apply(b,["MITHGrid.Data.Store"].concat(e.call(d),[function(d){var e,f,g,h,i,j,k,l,m,n;k=!1,l=c.Set.initInstance(),n={},j={},m={},h={},i=d.options,d.items=l.items,d.contains=l.contains,d.visit=l.visit,d.size=l.size,g=function(a,b,c,d){var e,f,g;f=a[b];if(f==null){f={values:{},counts:{}},a[b]=f,f.values[c]=[d],f.counts[c]={};return f.counts[c][d]=1}g=f.values,e=f.counts;if(g[c]==null){g[c]=[d],e[c]={};return e[c][d]=1}if(e[c][d]!=null)return e[c][d]+=1;g[c].push(d);return e[c][d]=1},f=function(a,b,c,d,e){var f,g,h,i,j,k,l;g=a[b];if(g!=null){f=g.values[c];if(f!=null)if(e!=null)for(i=0,k=f.length;i<k;i++)h=f[i],e.contains(h)&&d.add(h);else for(j=0,l=f.length;j<l;j++)h=f[j],d.add(h)}return!1},e=function(a,b,d,e,g){e==null&&(e=c.Set.initInstance()),b.visit(function(b){return f(a,b,d,e,g)});return e},d.addProperty=function(a,b){var d;d=c.Property.initInstance(a),(b!=null?b.valueType:void 0)!=null&&(d.valueType=b.valueType,j[a]=d);return d},d.getProperty=function(a){var b;return(b=j[a])!=null?b:c.Property.initInstance(a)},d.addType=function(a,b){var d;d=c.Type.initInstance(a),n[a]=d;return d},d.getType=function(a){var b;return(b=n[a])!=null?b:c.Type.initInstance(a)},d.getItem=function(a,b){var c,d,e;c=(d=(e=m[a])!=null?e.values:void 0)!=null?d:{};return b?b(null,c):c},d.getItems=function(a,c){var e,f,g,h,i,j,k;if(c!=null){f=b.initSyncronizer(c);if(a.length!=null)for(g=0,i=a.length;g<i;g++)e=a[g],f.increment(),d.getItem(e,function(a,b){c(a,b);return f.decrement()});else f.increment(),d.getItem(a,function(a,b){c(a,b);return f.decrement()});return f.done()}if(a.length){k=[];for(h=0,j=a.length;h<j;h++)e=a[h],k.push(d.getItem(e));return k}return[d.getItem(a)]},d.removeItems=function(b,c){var e,f,g,i,j,k,n,o;f=[],g=function(b,c,d,e){var f,g,h,i,j,k,l;h=b[c];if(h!=null){f=h.values[d],g=h.counts[d];if(f==null||g==null)return;g[e]-=1;if(g[e]<1){i=a.inArray(e,f),i===0?f=f.slice(1,f.length):i===f.length-1?f=f.slice(0,i):i>0&&(f=f.slice(0,i).concat(f.slice(i+1,f.length))),f.length>0?h.values[d]=f:delete h.values[d],delete g[e],k=0;for(j in g)l=g[j],k+=l;k===0&&delete b[c]}return!1}},i=function(a,b,c){g(m,a,b,c);return g(h,c,b,a)},k=function(a,b,c){var d,e,f,g;g=[];for(e=0,f=c.length;e<f;e++)d=c[e],g.push(i(a,b,d));return g},j=function(a){var b,c,e;b=d.getItem(a);for(e in b){c=b[e];if(typeof e!="string"||e==="id")continue;k(a,e,c)}return k(a,"id",[a])};for(n=0,o=b.length;n<o;n++)e=b[n],j(e),f.push(e),l.remove(e);d.events.onModelChange.fire(d,f);if(c!=null)return c()},d.updateItems=function(b,c){var e,f,i,j,k,l,n,o;i=[],k=function(b,c,d,e){var f,g,h,i;h=b[c];if(h!=null){f=h.values[d],g=h.counts[d];if(f==null||g==null)return;g[e]-=1;if(g[e]<1){i=a.inArray(e,f),i===0?f=f.slice(1,f.length):i===f.length-1?f=f.slice(0,i):i>0&&(f=f.slice(0,i).concat(f.slice(i+1,f.length))),f.length>0?h.values[d]=f:delete h.values[d];return delete g[e]}}},j=function(a,b,c){g(m,a,b,c);return g(h,c,b,a)},l=function(a,b,c){k(m,a,b,c);return k(h,c,b,a)},o=function(c){var e,f,g,h,i,k,m,n;f=c.id,e=!1,g=function(a,b){var c,d,e,f;d=!0;if(a.length!==b.length)return!1;for(c=e=0,f=a.length;0<=f?e<f:e>f;c=0<=f?++e:--e)a[c]!==b[c]&&(d=!1);return d},m=function(a,b,c){var d,e,f,g;g=[];for(e=0,f=c.length;e<f;e++)d=c[e],g.push(l(a,b,d));return g},k=function(a,b,c){var d,e,f,g;g=[];for(e=0,f=c.length;e<f;e++)d=c[e],g.push(j(a,b,d));return g},a.isArray(f)&&(f=f[0]),h=d.getItem(f);for(i in c){b=c[i];if(typeof i!="string"||i==="id")continue;a.isArray(b)||(b=[b]),n=b.length,h[i]==null?(k(f,i,b),e=!0):g(b,h[i])||(e=!0,m(f,i,h[i]),k(f,i,b))}return e},d.events.onBeforeUpdating.fire(d),n=b.length,e=parseInt(n/100,10),e>500&&(e=500),e<100&&(e=100),f=function(a){var g,h,j,k;g=a+e,g>n&&(g=n);for(j=k=a;a<=g?k<g:k>g;j=a<=g?++k:--k)h=b[j],typeof h=="object"&&o(h)&&i.push(h.id);if(g<n)return setTimeout(function(){return f(g)},0);d.events.onAfterUpdating.fire(d),d.events.onModelChange.fire(d,i);if(c!=null)return c()};return f(0)},d.loadItems=function(c,e){var f,i,j,k,n,o;j=[],k=function(a,b,c){g(m,a,b,c);return g(h,c,b,a)},n=function(c){var d,e,f,g,h;if(c.id==null)throw b.error("Item entry has no id: ",c);if(c.type==null)throw b.error("Item entry has no type: ",c);d=c.id,a.isArray(d)&&(d=d[0]),l.add(d),j.push(d),k(d,"id",d),h=[];for(e in c){f=c[e];if(typeof e!="string")continue;e!=="id"?a.isArray(f)?h.push(function(){var a,b,c;c=[];for(a=0,b=f.length;a<b;a++)g=f[a],c.push(k(d,e,g));return c}()):f!=null?h.push(k(d,e,f)):h.push(void 0):h.push(void 0)}return h},d.events.onBeforeLoading.fire(d),o=c.length,e!=null?(f=parseInt(o/100,10),f>500&&(f=500)):f=o,f<100&&(f=100),i=function(a){var b,g,h,k;b=a+f,b>o&&(b=o);for(h=k=a;a<=b?k<b:k>b;h=a<=b?++k:--k)g=c[h],typeof g=="object"&&n(g);if(b<o)return setTimeout(function(){return i(b)},0);d.events.onAfterLoading.fire(d),d.events.onModelChange.fire(d,j);if(e!=null)return e()};return i(0)},d.prepare=function(a){var c,e,f,g;f=b.Expression.Basic.initInstance(),e=function(){var b,d,e;e=[];for(b=0,d=a.length;b<d;b++)c=a[b],e.push(f.parse(c));return e}(),g=void 0;return{evaluate:function(a){var b,f,h,i;b=[],g=void 0,f=function(c){var e;e=c.evaluateOnItem(a,d),g||(g=e.valueType);return b=b.concat(e.values.items())};for(h=0,i=e.length;h<i;h++)c=e[h],f(c);return b},valueType:function(){return g}}},d.getObjectsUnion=function(a,b,c,d){return e(m,a,b,c,d)},d.getSubjectsUnion=function(a,b,c,d){return e(h,a,b,c,d)};return d.registerPresentation=function(a){a.onDestroy(d.events.onModelChange.addListener(function(b,c){return a.eventModelChange(b,c)}));return a.eventModelChange(d,d.items())}}]))}}),c.namespace("View",function(a){return a.initInstance=function(){var a;a=1<=arguments.length?e.call(arguments,0):[];return b.initInstance.apply(b,["MITHGrid.Data.View"].concat(e.call(a),[function(a){var d,e,g,h,i,j,k,l,m,n;k=c.Set.initInstance(),i=a.options,e=function(b){return!1!==a.events.onFilterItem.fire(a.dataStore,b)},g=function(b){var c,d,f,g;f=a.dataStore.items(),g=f.length;if(g===0)b();else{g>200?(c=parseInt(g/100,10),c>500&&(c=500)):c=g,c<100&&(c=100),d=function(h){var i,j,l,m;i=h+c,i>g&&(i=g);for(j=m=h;h<=i?m<i:m>i;j=h<=i?++m:--m)l=f[j],e(l)?k.add(l):k.remove(l);if(i<g)return setTimeout(function(){return d(i)},0);a.items=k.items,a.size=k.size,a.contains=k.contains,a.visit=k.visit;if(b!=null)return b()};return d(0)}},a.registerFilter=function(b){a.events.onFilterItem.addListener(function(a,c){return b.eventFilterItem(a,c)}),a.events.onModelChange.addListener(function(a,c){return b.eventModelChange(a,c)});return b.events.onFilterChange.addListener(a.eventFilterChange)},a.registerPresentation=function(b){b.onDestroy(a.events.onModelChange.addListener(function(a,c){return b.eventModelChange(a,c)}));return g(function(){return b.eventModelChange(a,a.items())})},a.items=k.items,a.contains=k.contains,a.visit=k.visit,a.size=k.size,a.eventFilterChange=function(){var b;b=c.Set.initInstance(a.items());return g(function(){var d,e,f,g,h,i,j,k;d=c.Set.initInstance(),j=b.items();for(f=0,h=j.length;f<h;f++)e=j[f],a.contains(e)||d.add(e);k=a.items();for(g=0,i=k.length;g<i;g++)e=k[g],b.contains(e)||d.add(e);if(d.size()>0)return a.events.onModelChange.fire(a,d.items())})},a.eventModelChange=function(b,d){var f,g,h,i;f=c.Set.initInstance();for(h=0,i=d.length;h<i;h++)g=d[h],b.contains(g)?e(g)?(k.add(g),f.add(g)):k.contains(g)&&(f.add(g),k.remove(g)):(f.add(g),k.remove(g));return a.events.onModelChange.fire(a,f.items())},(i!=null?(m=i.types)!=null?m.length:void 0:void 0)>0&&function(b){return a.registerFilter({eventFilterItem:function(a,c){var d,e,g,h;d=a.getItem(c);if(d.type==null)return!1;for(g=0,h=b.length;g<h;g++){e=b[g];if(f.call(d.type,e)>=0)return}return!1},eventModelChange:function(a,b){},events:{onFilterChange:{addListener:function(a){}}}})}(i.types),(i!=null?(n=i.filters)!=null?n.length:void 0:void 0)>0&&function(c){var d,e,f;f=b.Expression.Basic.initInstance(),e=function(){var a,b,e;e=[];for(a=0,b=c.length;a<b;a++)d=c[a],e.push(f.parse(d));return e}();return a.registerFilter({eventFilterItem:function(a,b){var c,f,g,h,i,j;for(g=0,i=e.length;g<i;g++){d=e[g],f=d.evaluateOnItem(b,a),f=f.values.items();for(h=0,j=f.length;h<j;h++){c=f[h];if(c!=="false")return}}return!1},eventModelChange:function(a,b){},events:{onFilterChange:{addListener:function(a){}}}})}(i.filters),(i!=null?i.collection:void 0)!=null&&a.registerFilter({eventFilterItem:i.collection,eventModelChange:function(a,b){},events:{onFilterChange:{addListener:function(a){}}}}),(i!=null?i.expressions:void 0)!=null&&(d=i.dataStore.prepare(i.expressions),j=a.eventModelChange,h=b.Data.Store.initInstance({}),l=b.Data.Set.initInstance(),a.eventModelChange=function(a,c){var e,g,i,k,m,n,o,p,q,r,s,t,u;m=[],o=[],i=b.Data.Set.initInstance(),i=h.getObjectsUnion(l,"mapsTo",i);for(q=0,s=c.length;q<s;q++){e=c[q];if(i.contains(e))m.push(e),a.contains(e)||(g=b.Data.Set.initInstance(),h.getSubjectsUnion(b.Data.Set.initInstance([e]),"mapsTo",g),g.visit(function(a){var b,c,d;c=h.getItem(a),d=c.mapsTo;if(d!=null){b=d.indexOf(e),b===0?d=d.slice(1,d.length):b===d.length-1?d=d.slice(0,d.length-1):b>-1&&(d=d.slice(0,b).concat(d.slice(b+1,d.length)));return h.updateItems([{id:a,mapsTo:d}])}}));else if(a.contains(e)){n=b.Data.Set.initInstance(),u=d.evaluate([e]);for(r=0,t=u.length;r<t;r++)p=u[r],n.add(p);h.contains(e)?h.updateItems([{id:e,mapsTo:n.items()}]):h.loadItems([{id:e,mapsTo:n.items()}])}else m=m.concat(h.getItem(e).mapsTo),o.push(e)}o.length>0&&h.removeItems(o),i=b.Data.Set.initInstance(),h.getObjectsUnion(l,"mapsTo",i),m=function(){var a,b,d;d=[];for(a=0,b=m.length;a<b;a++)k=m[a],f.call(c,k)>=0&&d.push(k);return d}();return j(i,m)}),a.dataStore=i.dataStore,a.getItems=a.dataStore.getItems,a.getItem=a.dataStore.getItem,a.removeItems=a.dataStore.removeItems,a.updateItems=a.dataStore.updateItems,a.loadItems=a.dataStore.loadItems,a.prepare=a.dataStore.prepare,a.addType=a.dataStore.addType,a.getType=a.dataStore.getType,a.addProperty=a.dataStore.addProperty,a.getProperty=a.dataStore.getProperty,a.getObjectsUnion=a.dataStore.getObjectsUnion,a.getSubjectsUnion=a.dataStore.getSubjectsUnion,a.dataStore.events.onModelChange.addListener(a.eventModelChange);return a.eventModelChange(a.dataStore,a.dataStore.items())}]))}}),c.namespace("SubSet",function(a){return a.initInstance=function(){var a;a=1<=arguments.length?e.call(arguments,0):[];return b.initInstance.apply(b,["MITHGrid.Data.SubSet"].concat(e.call(a),[function(a){var b,d,e,f;e=a.options,d=e.key,f=c.Set.initInstance(),a.items=f.items,a.contains=f.contains,a.visit=f.visit,a.size=f.size,a.setKey=function(e){var g,h;d=e,h=c.Set.initInstance(b.evaluate([d])),g=[],f.visit(function(a){if(!h.contains(a)){f.remove(a);return g.push(a)}}),h.visit(function(a){if(!f.contains(a)){f.add(a);return g.push(a)}});if(g.length>0)return a.events.onModelChange.fire(a,g)},b=e.dataStore.prepare(e.expressions),a.eventModelChange=function(e,g){var h,i,j,k,l;d!=null?j=c.Set.initInstance(b.evaluate([d])):j=c.Set.initInstance(),h=[];for(k=0,l=g.length;k<l;k++)i=g[k],f.contains(i)?(h.push(i),j.contains(i)||f.remove(i)):j.contains(i)&&(f.add(i),h.push(i));if(h.length>0)return a.events.onModelChange.fire(a,h)},a.dataStore=e.dataStore,a.getItems=a.dataStore.getItems,a.getItem=a.dataStore.getItem,a.removeItems=a.dataStore.removeItems,a.fetchData=a.dataStore.fetchData,a.updateItems=a.dataStore.updateItems,a.loadItems=a.dataStore.loadItems,a.prepare=a.dataStore.prepare,a.addType=a.dataStore.addType,a.getType=a.dataStore.getType,a.addProperty=a.dataStore.addProperty,a.getProperty=a.dataStore.getProperty,a.getObjectsUnion=a.dataStore.getObjectsUnion,a.getSubjectsUnion=a.dataStore.getSubjectsUnion,a.dataStore.events.onModelChange.addListener(a.eventModelChange),a.eventModelChange(a.dataStore,a.dataStore.items());return a.registerPresentation=function(b){b.onDestroy(a.events.onModelChange.addListener(function(a,c){return b.eventModelChange(a,c)}));return b.eventModelChange(a,a.items())}}]))}}),c.namespace("ListPager",function(a){return a.initInstance=function(){var a;a=1<=arguments.length?e.call(arguments,0):[];return b.initInstance.apply(b,["MITHGrid.Data.ListPager"].concat(e.call(a),[function(a){var b,d,e,g,h,i,j,k;i=a.options,d=[],e=0,g=-1,h=void 0,j=void 0,b=function(a){return d.indexOf(a)},k=c.Set.initInstance(),a.items=k.items,a.size=k.size,a.contains=k.contains,a.visit=k.visit,a.dataStore=i.dataStore,a.getItems=a.dataStore.getItems,a.getItem=a.dataStore.getItem,a.removeItems=a.dataStore.removeItems,a.fetchData=a.dataStore.fetchData,a.updateItems=a.dataStore.updateItems,a.loadItems=a.dataStore.loadItems,a.prepare=a.dataStore.prepare,a.addType=a.dataStore.addType,a.getType=a.dataStore.getType,a.addProperty=a.dataStore.addProperty,a.getProperty=a.dataStore.getProperty,a.getObjectsUnion=a.dataStore.getObjectsUnion,a.getSubjectsUnion=a.dataStore.getSubjectsUnion,a.setList=function(b){var c,h,i,j,l,m,n,o,p;d=b,c=[];for(i=0,l=d.length;i<l;i++)h=d[i],a.dataStore.contains(h)&&!k.contains(h)?e<=(n=d.indexOf(h))&&n<g&&(c.push(h),k.add(h)):k.contains(h)&&!a.dataStore.contains(h)&&(c.push(h),k.remove(h));o=k.items();for(j=0,m=o.length;j<m;j++){h=o[j];if((p=!h,f.call(d,p)>=0)||!a.dataStore.contains(h))c.push(h),k.remove(h)}if(c.length>0)return a.events.onModelChange.fire(a,c)},a.eventModelChange=function(c,d){var f,h,i,j,l;f=[];for(j=0,l=d.length;j<l;j++)h=d[j],c.contains(h)?(i=b(h),k.contains(h)?(f.push(h),(e>i||i>=g)&&k.remove(h)):e<=i&&i<g&&(k.add(h),f.push(h))):(k.remove(h),f.push(h));if(f.length>0)return a.events.onModelChange.fire(a,f)},a.setKeyRange=function(b,f){var h,i,j,l,m;b<f?(e=b,g=f):(e=f,g=b),l=k,h=c.Set.initInstance(),k=c.Set.initInstance(),a.items=k.items,a.size=k.size,a.contains=k.contains,a.visit=k.visit;if(e<g)for(i=m=e;e<=g?m<=g:m>=g;i=e<=g?++m:--m)j=d[i],l.contains(j)||h.add(j),k.add(j);l.visit(function(a){if(!k.contains(a))return h.add(a)});if(h.size()>0)return a.events.onModelChange.fire(a,h.items())},a.dataStore.registerPresentation(a);return a.registerPresentation=function(b){b.onDestroy(a.events.onModelChange.addListener(function(a,c){return b.eventModelChange(a,c)}));return b.eventModelChange(a,a.items())}}]))}}),c.namespace("Pager",function(a){return a.initInstance=function(){var a;a=1<=arguments.length?e.call(arguments,0):[];return b.initInstance.apply(b,["MITHGrid.Data.Pager"].concat(e.call(a),[function(a){var b,d,e,f,g,h,i,j,k,l,m;k=a.options,g=[],h=-1,i=-1,j=void 0,l=void 0,e=function(a){var b,c,d;if(a==null)return 0;b=0,d=g.length-1;while(b<d)c=~~((b+d)/2),g[c][0]<a?b=c+1:g[c][0]===a?d=c:d=c-1;while(g[b]!=null&&g[b][0]<a)b+=1;return b},f=function(a){var b,c,d;if(a==null)return g.length-1;b=0,d=g.length-1;while(b<d)c=~~((b+d)/2),g[c][0]<a?b=c+1:d=c-1;while(d>=0&&g[d][0]>=a)d-=1;return d},d=function(a){var b,c,d;for(b=c=0,d=g.length;0<=d?c<d:c>d;b=0<=d?++c:--c)if(g[b][1]===a)return b;return-1},m=c.Set.initInstance(),a.items=m.items,a.size=m.size,a.contains=m.contains,a.visit=m.visit,a.dataStore=k.dataStore,a.getItems=a.dataStore.getItems,a.getItem=a.dataStore.getItem,a.removeItems=a.dataStore.removeItems,a.fetchData=a.dataStore.fetchData,a.updateItems=a.dataStore.updateItems,a.loadItems=a.dataStore.loadItems,a.prepare=a.dataStore.prepare,a.addType=a.dataStore.addType,a.getType=a.dataStore.getType,a.addProperty=a.dataStore.addProperty,a.getProperty=a.dataStore.getProperty,a.getObjectsUnion=a.dataStore.getObjectsUnion,a.getSubjectsUnion=a.dataStore.getSubjectsUnion,b=a.prepare(k.expressions),a.eventModelChange=function(c,k){var n,o,p,q,r,s,t;n=[];for(s=0,t=k.length;s<t;s++)p=k[s],c.contains(p)?(r=b.evaluate(p),r.length>0?(b.valueType()==="numeric"?q=parseFloat(r[0]):q=r[0],m.contains(p)?(o=d(p),o===-1?g.push([q,p]):g[o][0]=q,n.push(p),(j!=null&&q<j||l!=null&&q>=l)&&m.remove(p)):(g.push([q,p]),(j==null||q>=j)&&(l==null||q<l)&&(m.add(p),n.push(p)))):m.contains(p)&&(o=d(p),o===0?g=g.slice(1,g.length):o===g.length-1?g=g.slice(0,g.length-1):o!==-1&&(g=g.slice(0,o).concat(g.slice(o+1,g.length))),m.remove(p),n.push(p))):(m.remove(p),n.push(p));g.sort(function(a,b){if(a[0]<b[0])return-1;if(a[0]>b[0])return 1;return 0}),h=e(j),i=f(l);if(n.length>0)return a.events.onModelChange.fire(a,n)},a.setKeyRange=function(b,d){var k,n,o,p,q;b!=null&&d!=null?b<d?(j=b,l=d):(j=d,l=b):(j=b,l=d),h=e(j),i=f(l),k=c.Set.initInstance(),p=m,m=c.Set.initInstance(),a.items=m.items,a.size=m.size,a.contains=m.contains,a.visit=m.visit;if(h<=i)for(n=q=h;h<=i?q<=i:q>=i;n=h<=i?++q:--q)o=g[n][1],p.contains(o)||k.add(o),m.add(o);p.visit(function(a){if(!m.contains(a))return k.add(a)});if(k.size()>0)return a.events.onModelChange.fire(a,k.items())},a.dataStore.registerPresentation(a);return a.registerPresentation=function(b){b.onDestroy(a.events.onModelChange.addListener(function(a,c){return b.eventModelChange(a,c)}));return b.eventModelChange(a,a.items())}}]))}});return c.namespace("RangePager",function(a){return a.initInstance=function(){var a;a=1<=arguments.length?e.call(arguments,0):[];return b.initInstance.apply(b,["MITHGrid.Data.RangePager"].concat(e.call(a),[function(a){var b,d,e,f;d=a.options,b=c.Pager.initInstance({dataStore:d.dataStore,expressions:d.leftExpressions}),e=c.Pager.initInstance({dataStore:d.dataStore,expressions:d.rightExpressions}),f=c.Set.initInstance(),a.items=f.items,a.size=f.size,a.contains=f.contains,a.visit=f.visit,a.dataStore=d.dataStore,a.getItems=a.dataStore.getItems,a.getItem=a.dataStore.getItem,a.removeItems=a.dataStore.removeItems,a.fetchData=a.dataStore.fetchData,a.updateItems=a.dataStore.updateItems,a.loadItems=a.dataStore.loadItems,a.prepare=a.dataStore.prepare,a.addType=a.dataStore.addType,a.getType=a.dataStore.getType,a.addProperty=a.dataStore.addProperty,a.getProperty=a.dataStore.getProperty,a.getObjectsUnion=a.dataStore.getObjectsUnion,a.getSubjectsUnion=a.dataStore.getSubjectsUnion,a.eventModelChange=function(c,d){var g,h,i,j;g=[];for(i=0,j=d.length;i<j;i++)h=d[i],b.contains(h)&&e.contains(h)?(g.push(h),f.add(h)):f.contains(h)&&(g.push(h),f.remove(h));return a.events.onModelChange.fire(a,g)},a.setKeyRange=function(a,c){var d;a!=null&&c!=null&&a>c&&(d=[c,a],a=d[0],c=d[1]),b.setKeyRange(void 0,c);return e.setKeyRange(a,void 0)},b.registerPresentation(a),e.registerPresentation(a),a.setKeyRange(void 0,void 0);return a.registerPresentation=function(b){b.onDestroy(a.events.onModelChange.addListener(function(a,c){return b.eventModelChange(a,c)}));return b.eventModelChange(a,a.items())}}]))}})}),b.namespace("Expression.Basic",function(c){var d,e;d={},e={"+":{argumentType:"number",valueType:"number",f:function(a,b){return a+b}},"-":{argumentType:"number",valueType:"number",f:function(a,b){return a-b}},"*":{argumentType:"number",valueType:"number",f:function(a,b){return a*b}},"/":{argumentType:"number",valueType:"number",f:function(a,b){return a/b}},"=":{valueType:"boolean",f:function(a,b){return a===b}},"<>":{valueType:"boolean",f:function(a,b){return a!==b}},"><":{valueType:"boolean",f:function(a,b){return a!==b}},"<":{valueType:"boolean",f:function(a,b){return a<b}},">":{valueType:"boolean",f:function(a,b){return a>b}},"<=":{valueType:"boolean",f:function(a,b){return a<=b}},">=":{valueType:"boolean",f:function(a,b){return a>=b}}},d.controls=c.controls={"if":{f:function(a,b,c,d,e){var f,g;g=a[0].evaluate(b,c,d,e),f=!1,g.forEachValue(function(a){if(a){f=!0;return!0}return void 0});return f?a[1].evaluate(b,c,d,e):a[2].evaluate(b,c,d,e)}},foreach:{f:function(a,b,c,e,f){var g,h,i,j,k;g=a[0].evaluate(b,c,e,f),h=b.value,i=c.value,j=[],k="text",c.value=g.valueType,g.forEachValue(function(d){var g;b.value=d,g=a[1].evaluate(b,c,e,f),k=g.valueType;return g.forEachValue(function(a){return j.push(a)})}),b.value=h,c.value=i;return d.initCollection(j,k)}},"default":{f:function(a,b,c,e,f){var g,h,i,j;for(i=0,j=a.length;i<j;i++){g=a[i],h=g.evaluate(b,c,e,f);if(h.size()>0)return h}return d.initCollection([],"text")}}},d.initExpression=function(a){var b;b={},b.evaluate=function(b,c,d,e){var f;f=a.evaluate(b,c,d,e);return{values:f.getSet(),valueType:f.valueType,size:f.size}},b.evaluateOnItem=function(a,c){return b.evaluate({value:a},{value:"item"},"value",c)},b.evaluateSingle=function(b,c,d,e){var f,g;f=a.evaluate(b,c,d,e),g={value:null,valueType:f.valueType},f.forEachValue(function(a){g.value=a;return!0});return g},b.isPath=a.isPath,b.isPath?(b.getPath=function(){return a},b.testExists=function(b,c,d,e){return a.testExists(b,c,d,e)}):(b.getPath=function(){return null},b.testExists=function(a,c,d,e){return b.evaluate(a,c,d,e).values.size()>0}),b.evaluateBackward=function(b,c,d,e){return a.walkBackward([b],c,d,e)},b.walkForward=function(b,c,d){return a.walkForward(b,c,d)},b.walkBackward=function(b,c,d,e){return a.walkBackward(b,c,d,e)};return b},d.initCollection=c.initCollection=function(a,c){var d;d={valueType:c},a instanceof Array?(d.forEachValue=function(b){var c,d,e,f;f=[];for(d=0,e=a.length;d<e;d++){c=a[d];if(b(c)===!0)break;f.push(void 0)}return f},d.getSet=function(){return b.Data.Set.initInstance(a)},d.contains=function(b){return f.call(a,b)>=0},d.size=function(){return a.length}):(d.forEachValue=a.visit,d.size=a.size,d.getSet=function(){return a},d.contains=a.contains),d.isPath=!1;return d},d.initConstant=function(a,b){var c;c={},c.evaluate=function(c,e,f,g){return d.initCollection([a],b)},c.isPath=!1;return c},d.initOperator=function(a,b){var c,f,g;c={},g=a,f=b,c.evaluate=function(c,h,i,j){var k,l,m,n,o;m=[],b=[];for(n=0,o=f.length;n<o;n++)k=f[n],b.push(k.evaluate(c,h,i,j));a=e[g],l=a.f,a.argumentType==="number"?b[0].forEachValue(function(a){typeof a!="number"&&(a=parseFloat(a));return b[1].forEachValue(function(b){typeof b!="number"&&(b=parseFloat(b));return m.push(l(a,b))})}):b[0].forEachValue(function(a){return b[1].forEachValue(function(b){return m.push(l(a,b))})});return d.initCollection(m,a.valueType)},c.isPath=!1;return c},d.initFunctionCall=function(a,b){var c,e;c={},e=b,c.evaluate=function(c,f,g,h){var i,j,k,l;b=[];for(j=0,k=e.length;j<k;j++)i=e[j],b.push(i.evaluate(c,f,g,h));if(((l=d.functions[a])!=null?l.f:void 0)!=null)return d.functions[a].f(b);throw new Error("No such function named "+_name)},c.isPath=!1;return c},d.initControlCall=function(a,b){var c;c={},c.evaluate=function(c,e,f,g){return d.controls[a].f(b,c,e,f,g)},c.isPath=!1;return c},d.initPath=function(c,e){var f,g,h,i,j;f={},i=null,j=[],h=function(a,b){var e,f,g,h,i,k,l,m,n;g=function(c){var d;d=[],a.forEachValue(function(a){return b.getObjects(a,c.property).visit(function(a){return d.push(a)})});return d},f=function(c){var d;d=[],a.forEachValue(function(a){return b.getSubjects(a,c.property).visit(function(a){return d.push(a)})});return d};for(h=m=0,n=j.length;0<=n?m<n:m>n;h=0<=n?++m:--m)i=j[h],i.isMultiple?(e=[],i.forward?(e=g(i),c=b.getProperty(i.property),k=c!=null?c.getValueType():"text"):(e=f(i),k="item"),a=d.initCollection(e,k)):i.forward?(l=b.getObjectsUnion(a.getSet(),i.property),c=b.getProperty(i.property),k=c!=null?c.getValueType():"text",a=d.initCollection(l,k)):(l=b.getSubjectsUnion(a.getSet(),i.property),a=d.initCollection(l,"item"));return a},g=function(a,e,f){var g,h,i,k,l,m,n,o,p;i=function(b){var c;c=[],a.forEachValue(function(a){return f.getSubjects(a,b.property).visit(function(a){if(k>0||e==null||e.contains(a))return c.push(a)})});return c},h=function(b){var c;c=[],a.forEachValue(function(a){return f.getObjects(a,b.property).visit(function(a){if(k>0||e==null||e.contains(a))return c.push(a)})});return c},e instanceof Array&&(e=b.Data.Set.initInstance(e));for(k=o=p=j.length-1;p<=0?o<=0:o>=0;k=p<=0?++o:--o)l=j[k],l.isMultiple?(g=[],l.forward?(g=i(l),c=f.getProperty(l.property),m=c!=null?c.getValueType():"text"
):(g=h(l),m="item"),a=d.initCollection(g,m)):l.forward?(n=f.getSubjectsUnion(a.getSet(),l.property,null,k===0?e:null),a=d.initCollection(n,"item")):(n=f.getObjectsUnion(a.getSet(),l.property,null,k===0?e:null),c=f.getProperty(l.property),m=c!=null?c.getValueType():"text",a=d.initCollection(n,m));return a},c!=null&&j.push({property:c,forward:e,isMultiple:!1}),f.isPath=!0,f.setRootName=function(a){return i=a},f.appendSegment=function(a,b){return j.push({property:a,forward:b[0]===".",isMultiple:b.length>1})},f.getSegment=function(a){var b;if(a<j.length){b=j[a];return{property:b.property,forward:b.forward,isMultiple:b.isMultiple}}return null},f.getLastSegment=function(){return f.getSegment(j.length-1)},f.getSegmentCount=function(){return j.length},f.rangeBackward=function(a,d,e,f){var g,h,i,k,l,m;i=b.Data.Set.initInstance(),k="item";if(j.length>0){h=j[j.length-1];if(h.forward)f.getSubjectsInRange(h.property,a,d,!1,i,j.length===1?e:null);else throw new Error("Last path of segment must be forward");for(g=l=m=j.length-2;m<=0?l<=0:l>=0;g=m<=0?++l:--l)h=j[g],h.forward?(i=f.getSubjectsUnion(i,h.property,null,g===0?e:null),k="item"):(i=f.getObjectsUnion(i,h.property,null,g===0?e:null),c=f.getPropertysegment.property,k=c!=null?c.getValueType():"text")}return{valueType:k,values:i,count:i.size()}},f.evaluate=function(b,c,e,f){var g,j,k,l;k=i!=null?i:e,l=c[k]!=null?c[k]:"text",g=null;if(b[k]!=null){j=b[k],a.isPlainObject(j)||j instanceof Array?g=d.initCollection(j,l):g=d.initCollection([j],l);return h(g,f)}throw new Error("No such variable called "+k)},f.testExists=function(a,b,c,d){return f.evaluate(a,b,c,d).size()>0},f.evaluateBackward=function(a,b,c,e){var f;f=d.initCollection([a],b);return g(f,c,e)},f.walkForward=function(a,b,c){return h(d.initCollection(a,b),c)},f.walkBackward=function(a,b,c,e){return g(d.initCollection(a,b),c,e)};return f},d.initParser=c.initInstance=function(){var a,b;b={},a=function(a,b){var c,e,f,g,h,i,j,k,l,m,n,o;m=a.token(),c=d.initScanner,g=function(){a.next();return m=a.token()},i=function(){var a;a=[h()];while(m!=null&&m.type===c.DELIMITER&&m.value===",")g(),a.push(h());return a},f=function(){return m!=null?m.start:a.index()},j=function(){var a,b;b=d.initPath();while(m!=null&&m.type===c.PATH_OPERATOR){a=m.value,g();if(m!=null&&m.type===c.IDENTIFIER)b.appendSegment(m.value,a),g();else throw new Error("Missing property ID at position "+f())}return b},h=function(){var a,b,e;e=null,a=[];if(m==null)throw new Error("Missing factor at end of expression");switch(m.type){case c.NUMBER:e=d.initConstant(m.value,"number"),g();break;case c.STRING:e=d.initConstant(m.value,"text"),g();break;case c.PATH_OPERATOR:e=j();break;case c.IDENTIFIER:b=m.value,g();if(d.controls[b]!=null){if(m==null||m.type!==c.DELIMITER||m.value!=="(")throw new Error("Missing ( to start "+b+" at position "+f());g(),m!=null&&m.type===c.DELIMITER&&m.value===")"?a=[]:a=i(),e=d.initControlCall(b,a);if(m!=null&&m.type===c.DELIMITER&&m.value===")")g();else throw new Error("Missing ) to end "+b+" at position "+f())}else if(m!=null&&m.type===c.DELIMITER&&m.value==="("){g(),m!=null&&m.type===c.DELIMITER&&m.value===")"?a=[]:a=i(),e=d.initFunctionCall(b,a);if(m!=null&&m.type===c.DELIMITER&&m.value===")")g();else throw new Error("Missing ) after function call "+b+" at position "+f())}else e=j(),e.setRootName(b);break;case c.DELIMITER:if(m.value!=="(")throw new Error("Unexpected text "+m.value+" at position "+f());g(),e=h();if(m!=null&&m.type===c.DELIMITER&&m.value===")")g();else throw new Error("Missing ) at position "+f());break;default:throw new Error("Unexpected text "+m.value+" at position "+f())}return e};if(b){l=i(),e=[];for(n=0,o=l.length;n<o;n++)k=l[n],e.push(d.initExpression(k));return e}return[d.initExpression(h())]},b.parse=function(b,c,e){var f;c==null&&(c=0),e==null&&(e={}),f=d.initScanner(b,c);try{return a(f,!1)[0]}finally{e.index=f.token()!=null?f.token().start:f.index()}};return b},d.initScanner=function(a,b){var c,e,f,g,h,i;e={},h=a+" ",g=a.length,f=b,i=null,c=function(a){return"0123456789".indexOf(a)>=0},e.token=function(){return i},e.index=function(){return f},e.next=function(){var a,b,e,j,k;i=null;while(f<g&&" \t\r\n".indexOf(h.charAt(f))>=0)f+=1;if(f<g){b=h.charAt(f),e=h.charAt(f+1),j=h.charAt(f+2);if(".!".indexOf(b)<0){if(b==="<"&&e==="-"){if(j==="@"){i={type:d.initScanner.PATH_OPERATOR,value:"!@",start:f,end:f+3};return f+=3}i={type:d.initScanner.PATH_OPERATOR,value:"!",start:f,end:f+2};return f+=2}if(b==="-"&&e===">"){if(j==="@"){i={type:d.initScanner.PATH_OPERATOR,value:".@",start:f,end:f+3};return f+=3}i={type:d.initScanner.PATH_OPERATOR,value:".",start:f,end:f+2};return f+=2}if("<>".indexOf(b)<0){if("+-*/=".indexOf(b)<0){if("()".indexOf(b)<0){if("\"'".indexOf(b)<0){if(c(b)){k=f;while(k<g&&c(h.charAt(k)))k+=1;if(k<g&&h.charAt(k)==="."){k+=1;while(k<g&&c(h.charAt(k)))k+=1}i={type:d.initScanner.NUMBER,value:parseFloat(h.substring(f,k)),start:f,end:k};return f=k}k=f;while(k<g){a=h.charAt(k);if("(),.!@ \t".indexOf(a)>=0)break;k+=1}i={type:d.initScanner.IDENTIFIER,value:h.substring(f,k),start:f,end:k};return f=k}k=f+1;while(k<g){if(h.charAt(k)===b&&h.charAt(k-1)!=="\\")break;k+=1}if(k<g){i={type:d.initScanner.STRING,value:h.substring(f+1,k).replace(/\\'/g,"'").replace(/\\"/g,'"'),start:f,end:k+1};return f=k+1}throw new Error("Unterminated string starting at "+String(f))}i={type:d.initScanner.DELIMITER,value:b,start:f,end:f+1};return f+=1}i={type:d.initScanner.OPERATOR,value:b,start:f,end:f+1};return f+=1}if(e==="="||"<>".indexOf(e)>=0&&b!==e){i={type:d.initScanner.OPERATOR,value:b+e,start:f,end:f+2};return f+=2}i={type:d.initScanner.OPERATOR,value:b,start:f,end:f+1};return f+=1}if(e==="@"){i={type:d.initScanner.PATH_OPERATOR,value:b+e,start:f,end:f+2};return f+=2}i={type:d.initScanner.PATH_OPERATOR,value:b,start:f,end:f+1};return f+=1}},e.next();return e},d.initScanner.DELIMITER=0,d.initScanner.NUMBER=1,d.initScanner.STRING=2,d.initScanner.IDENTIFIER=3,d.initScanner.OPERATOR=4,d.initScanner.PATH_OPERATOR=5,d.functions={},d.FunctionUtilities={};return c.registerSimpleMappingFunction=function(a,c,e){return d.functions[a]={f:function(a){var f,g,h,i,j;h=b.Data.Set.initInstance(),g=function(a){return a.forEachValue(function(a){var b;b=c(a);if(b!=null)return h.add(b)})};for(i=0,j=a.length;i<j;i++)f=a[i],g(f);return d.initCollection(h,e)}}}}),b.namespace("Presentation",function(c){c.initInstance=function(){var c;c=1<=arguments.length?e.call(arguments,0):[];return b.initInstance.apply(b,["MITHGrid.Presentation"].concat(e.call(c),[function(b,c){var d,e,f,g,h;d=null,h={},f=b.options.lenses||{},g=b.options,a(c).empty(),e=void 0,g.lensKey||(g.lensKey=[".type"]),b.getLens=function(a){var b,c;e!=null&&(c=e.evaluate([a]),b=c[0]);if(b!=null&&f[b]!=null)return{render:f[b]}},b.addLens=function(a,c){f[a]=c;return b.selfRender()},b.removeLens=function(a){return delete f[a]},b.hasLens=function(a){return f[a]!=null},b.visitRenderings=function(a){var b,c;for(b in h){c=h[b];if(!1===a(b,c))return}},b.renderingFor=function(a){return h[a]},b.renderItems=function(a,f){var i,j,k;e==null&&(e=a.prepare(g.lensKey)),j=f.length,k=j,k>200&&(k=parseInt(Math.sqrt(k),10)+1),k<1&&(k=1),i=function(e){var g,l,m,o,p,q;if(e<j){g=e+k,g>j&&(g=j);for(m=q=e;e<=g?q<g:q>g;m=e<=g?++q:--q)o=f[m],l=a.contains(o)&&b.hasLensFor(o),h[o]!=null?l?h[o].update(a.getItem(o)):(d===o&&h[o].eventUnfocus!=null&&h[o].eventUnfocus(),h[o].remove!=null&&h[o].remove(),delete h[o]):l&&(p=b.render(c,a,o),p!=null&&(h[o]=p,d===o&&p.eventFocus!=null&&p.eventFocus()));return setTimeout(function(){return i(g)},0)}if(b.finishDisplayUpdate!=null)return b.finishDisplayUpdate()},b.startDisplayUpdate();return i(0)},b.render=function(a,c,d){var e;e=b.getLens(d);if(e!=null)return e.render(a,b,c,d)},b.hasLensFor=function(a){var c;c=b.getLens(a);return c!=null},b.eventModelChange=b.renderItems,b.startDisplayUpdate=function(){},b.finishDisplayUpdate=function(){},b.selfRender=function(){return b.renderItems(b.dataView,b.dataView.items())},b.eventFocusChange=function(a){var c;d!=null&&(c=b.renderingFor(d)),d!==a&&(c!=null&&c.eventUnfocus!=null&&c.eventUnfocus(),a!=null&&(c=b.renderingFor(a),c!=null&&c.eventFocus!=null&&c.eventFocus()),d=a);return d},b.getFocusedRendering=function(){return d!=null?b.renderingFor(d):null},b.dataView=b.options.dataView;return b.dataView.registerPresentation(b)}]))},c.namespace("SimpleText",function(a){return a.initInstance=function(){var a,c;a=1<=arguments.length?e.call(arguments,0):[];return(c=b.Presentation).initInstance.apply(c,["MITHGrid.Presentation.SimpleText"].concat(e.call(a),[function(a,b){}]))}});return c.namespace("Table",function(c){return c.initInstance=function(){var c,d;c=1<=arguments.length?e.call(arguments,0):[];return(d=b.Presentation).initInstance.apply(d,["MITHGrid.Presentation.Table"].concat(e.call(c),[function(b,c){var d,e,f,g,h,i,j,k;f=b.options,h=a("<table></table>"),e=a("<tr></tr>"),h.append(e),k=f.columns;for(i=0,j=k.length;i<j;i++)d=k[i],e.append("<th>"+f.columnLabels[d]+"</th>");a(c).append(h),b.hasLensFor=function(){return!0},g=function(a){var b,c;a!=null?(a=[].concat(a),a.length>1?(b=a.pop(),c=a.join(", "),a.length>1?c=c+", and "+b:c=c(" and "+b)):c=a[0]):c="";return c};return b.render=function(b,c,e){var i,j,k,l,m,n,o,p,q;j={},n={},k=a("<tr></tr>"),n.el=k,m=c.getItem(e),l=!0,q=f.columns;for(o=0,p=q.length;o<p;o++)d=q[o],i=a("<td></td>"),m[d]!=null&&(i.text(g(m[d])),l=!1,j[d]=i),k.append(i);if(!l){h.append(k),n.update=function(a){var b,c,e,h;e=f.columns,h=[];for(b=0,c=e.length;b<c;b++)d=e[b],a[d]!=null?h.push(j[d].text(g(a[d]))):h.push(void 0);return h},n.remove=function(){k.hide();return k.remove()};return n}k.remove();return null}}]))}})}),b.namespace("Facet",function(c){c.initInstance=function(){var c;c=1<=arguments.length?e.call(arguments,0):[];return b.initInstance.apply(b,["MITHGrid.Facet"].concat(e.call(c),[function(b,c){var d;d=b.options,b.selfRender=function(){},b.eventFilterItem=function(a,b){return!1},b.eventModelChange=function(a,b){},b.constructFacetFrame=function(b,c){var d;d={},a(b).addClass("mithgrid-facet"),d.header=a("<div class='header' />"),c.onClearAllSelections!=null&&(d.controls=a("<div class='control' title='Clear Selection'>"),d.counter=a("<span class='counter'></span>"),d.controls.append(d.counter),d.header.append(d.controls)),d.title=a("<span class='title'></span>"),d.title.text(c.facetLabel||""),d.header.append(d.title),d.bodyFrame=a("<div class='body-frame'></div>"),d.body=a("<div class='body'></div>"),d.bodyFrame.append(d.body),a(b).append(d.header),a(b).append(d.bodyFrame),c.onClearAllSelections!=null&&d.controls.bind("click",c.onClearAllSelections),d.setSelectionCount=function(a){d.counter.innerHTML=a;return a>0?d.counter.show():d.counter.hide()};return d};return d.dataView.registerFilter(b)}]))},c.namespace("TextSearch",function(d){return d.initInstance=function(){var d;d=1<=arguments.length?e.call(arguments,0):[];return c.initInstance.apply(c,["MITHGrid.Facet.TextSearch"].concat(e.call(d),[function(c){var d,e,f,g;e=c.options,e.expressions!=null&&(a.isArray(e.expressions)||(e.expressions=[e.expressions]),g=b.Expression.Basic.initInstance(),f=function(){var a,b,c,f;c=e.expressions,f=[];for(a=0,b=c.length;a<b;a++)d=c[a],f.push(g.parse(d));return f}()),c.eventFilterItem=function(a,b){var g,h,i,j,k,l,m;if(c.text!=null&&e.expressions!=null)for(i=0,k=f.length;i<k;i++){d=f[i],g=d.evaluateOnItem(b,a),m=g.values.items();for(j=0,l=m.length;j<l;j++){h=m[j];if(h.toLowerCase().indexOf(c.text)>=0)return}}return!1},c.eventModelChange=function(a,b){};return c.selfRender=function(){var b,d;b=c.constructFacetFrame(container,null,{facetLabel:e.facetLabel}),a(container).addClass("mithgrid-facet-textsearch"),d=a("<input type='text'>"),b.body.append(d);return d.keyup(function(){c.text=a.trim(d.val().toLowerCase());return c.events.onFilterChange.fire()})}}]))}}),c.namespace("List",function(d){return d.initInstance=function(){var d;d=1<=arguments.length?e.call(arguments,0):[];return c.initInstance.apply(c,["MITHGrid.Facet.List"].concat(e.call(d),[function(c){var d,e,g,h;e=c.options,c.selections=[],e.expressions!=null&&(a.isArray(e.expressions)||(e.expressions=[e.expressions]),h=b.Expression.Basic.initInstance(),g=function(){var a,b,c,f;c=e.expressions,f=[];for(a=0,b=c.length;a<b;a++)d=c[a],f.push(h.parse(d));return f}()),c.eventFilterItem=function(a,b){var h,i,j,k,l,m,n;if(c.text!=null&&e.expressions!=null)for(j=0,l=g.length;j<l;j++){d=g[j],h=d.evaluateOnItem(b,a),n=h.values.items();for(k=0,m=n.length;k<m;k++){i=n[k];if(f.call(c.selections,i)>=0)return}}};return c.selfRender=function(){var a;return a=c.constructFacetFrame(container,null,{facetLabel:e.facetLabel,resizable:!0})}}]))}});return c.namespace("Range",function(b){return b.initInstance=function(){var b;b=1<=arguments.length?e.call(arguments,0):[];return c.initInstance.apply(c,["MITHGrid.Facet.Range"].concat(e.call(b),[function(b){var c,d,e,f;c=b.options,(d=c.min)==null&&(c.min=0),(e=c.max)==null&&(c.max=100),(f=c.step)==null&&(c.step=1/30);return b.selfRender=function(){var d,e;d=b.constructFacetFrame(container,null,{facetLabel:c.facetLabel,resizable:!1}),e=a("<input type='range'>"),e.attr({min:c.min,max:c.max,step:c.step}),d.body.append(e);return e.event(function(){b.value=e.val();return b.events.onFilterChange.fire()})}}]))}})}),b.namespace("Controller",function(c){c.initInstance=function(){var c;c=1<=arguments.length?e.call(arguments,0):[];return b.initInstance.apply(b,["MITHGrid.Controller"].concat(e.call(c),[function(c){var d,f,g,h;d=c.options,(g=d.selectors)==null&&(d.selectors={}),(h=(f=d.selectors)[""])==null&&(f[""]=""),c.initBind=function(c){return b.initInstance(d.bind,function(b){var e;e={"":a(c)},b.locate=function(b){var f,g;g=d.selectors[b];if(g!=null){g===""?f=a(c):f=a(c).find(g),e[g]=f;return f}return void 0},b.fastLocate=function(a){var c;c=d.selectors[a];if(c!=null){if(e[c]!=null)return e[c];return b.locate(a)}return void 0},b.refresh=function(b){var f,g,h,i;for(h=0,i=b.length;h<i;h++)f=b[h],g=d.selectors[f],g!=null&&(g===""?e[""]=a(c):e[g]=a(c).find(g));return void 0};return b.clearCache=function(){return e={"":a(c)}}})},c.bind=function(){var a,b,d;d=arguments[0],a=2<=arguments.length?e.call(arguments,1):[],b=c.initBind(d),c.applyBindings.apply(c,[b].concat(e.call(a))),b.unbind=function(){return c.removeBindings.apply(c,[b].concat(e.call(a)))};return b},c.applyBindings=function(){var a,b;b=arguments[0],a=2<=arguments.length?e.call(arguments,1):[]};return c.removeBindings=function(){var a,b;b=arguments[0],a=2<=arguments.length?e.call(arguments,1):[]}}]))};return c.namespace("Raphael",function(a){return a.initInstance=function(){var a,c;a=1<=arguments.length?e.call(arguments,0):[];return(c=b.Controller).initInstance.apply(c,["MITHGrid.Controller.Raphael"].concat(e.call(a),[function(a){var b;b=a.initBind;return a.initBind=function(a){var c,d,e,f,g;c=b(a.node),f=c.locate,e=c.fastLocate,g=c.refresh,d=c.bind,c.locate=function(b){return b==="raphael"?a:f(b)},c.fastLocate=function(b){return b==="raphael"?a:e(b)},c.refresh=function(a){var b;a=function(){var c,d,e;e=[];for(c=0,d=a.length;c<d;c++)b=a[c],b!=="raphael"&&e.push(b);return e}();return g(a)};return c}}]))}})}),b.namespace("Application",function(c){return c.initInstance=function(){var c;c=1<=arguments.length?e.call(arguments,0):[];return b.initInstance.apply(b,["MITHGrid.Application"].concat(e.call(c),[function(c,d){var e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w,x,y,z,A;j=[],o=function(){return c},c.presentation={},c.facet={},c.component={},c.dataStore={},c.dataView={},c.controller={},k=c.options,c.ready=function(a){return j.push(a)},c.run=function(){return a(document).ready(function(){var a,b,d;c.ready=function(a){return a()};for(b=0,d=j.length;b<d;b++)a=j[b],a();return j=[]})},c.addDataStore=function(a,d){var e,f,g,h,i,j,k,l;c.dataStore[a]==null?(g=b.Data.Store.initInstance(),c.dataStore[a]=g,g.addType("Item"),g.addProperty("type",{valueType:"text"}),g.addProperty("id",{valueType:"text"})):g=c.dataStore[a];if((d!=null?d.types:void 0)!=null){j=d.types;for(h in j)i=j[h],g.addType(h)}if((d!=null?d.properties:void 0)!=null){k=d.properties,l=[];for(e in k)f=k[e],l.push(g.addProperty(e,f));return l}},c.addDataView=function(a,d){var e,f,g,h,i;d.type!=null&&d.type.initInstance!=null?e=d.type.initInstance:e=b.Data.View.initInstance,i={dataStore:c.dataStore[d.dataStore]||c.dataView[d.dataStore]};if(c.dataView[a]==null){for(f in d)g=d[f],f!=="type"&&!i[f]&&(i[f]=g);h=e(i);return c.dataView[a]=h}},c.addController=function(b,d){var e,f;f=a.extend(!0,{},d),f.application=o,e=d.type.initInstance(f);return c.controller[b]=e},c.addFacet=function(b,e){var f;f=a.extend(!0,{},e);return c.ready(function(){var g,h;h=a(d).find(e.container),a.isArray(h)&&(h=h[0]),f.dataView=c.dataView[e.dataView],f.application=o,g=e.type.initInstance(h,f),c.facet[b]=g;return g.selfRender()})},c.addComponent=function(b,e){var g;g=a.extend(!0,{},f);return c.ready(function(){var f,h,i,j,k,l;i=a(d).find(g.container),a.isArray(i)&&(i=i[0]),g.application=o;if(h.components!=null){g.components={},k=h.components;for(f in k)h=k[f],typeof h=="string"?g.components[f]=c.component[f]:(j=a.extend(!0,{},ccconfig),j.application=o,g.components[f]=h.type.initInstance(j))}if(h.controllers!=null){g.controllers={},l=e.controllers;for(f in l)h=l[f],typeof h=="string"?g.controllers[f]=c.controller[f]:(j=a.extend(!0,{},ccconfig),j.application=o,g.controllers[f]=h.type.initInstance(j))}return c.component[b]=h.type.initInstance(i,g)})},c.addPresentation=function(b,e){var f;f=a.extend(!0,{},e);return c.ready(function(){var g,h,i,j,k,l,m,n,p;l=a(d).find(f.container),a.isArray(l)&&(l=l[0]),f.dataView=c.dataView[e.dataView],f.application=o;if(e.components!=null){f.components={},n=e.components;for(h in n)i=n[h],typeof i=="string"?f.components[h]=c.component[h]:(j=a.extend(!0,{},ccconfig),j.application=o,f.components[h]=i.type.initInstance(j))}if(e.controllers!=null){f.controllers={},p=e.controllers;for(g in p)i=p[g],typeof i=="string"?f.controllers[g]=c.controller[g]:(k=a.extend(!0,{},i),k.application=o,f.controllers[g]=i.type.initInstance(k))}m=e.type.initInstance(l,f),c.presentation[b]=m;return m.selfRender()})},c.addPlugin=function(b){var e,f,g,h,i,j,k,l,m,n,p,q;e=a.extend(!0,{},b),e.application=o,f=e.type.initInstance(e);if(f!=null){if((e!=null?e.dataView:void 0)!=null){f.dataView=c.dataView[e.dataView],m=f.getTypes();for(k in m)l=m[k],f.dataView.addType(k);n=f.getProperties();for(i in n)j=n[i],f.dataView.addProperty(i,j)}p=f.getPresentations(),q=[];for(g in p)h=p[g],q.push(function(b,g){return c.ready(function(){var h,i,j;j=a.extend(!0,{},g.options),h=a(d).find(g.container),a.isArray(h)&&(h=h[0]),(g!=null?g.lenses:void 0)!=null&&(j.lenses=g.lenses),g.dataView!=null?j.dataView=c.dataView[g.dataView]:e.dataView!=null&&(j.dataView=c.dataView[e.dataView]),j.application=o,i=g.type.initInstance(h,j),f.presentation[b]=i;return i.selfRender()})});return q}};if((k!=null?k.dataStores:void 0)!=null){t=k.dataStores;for(n in t)g=t[n],c.addDataStore(n,g)}if((k!=null?k.dataViews:void 0)!=null){u=k.dataViews;for(q in u)p=u[q],c.addDataView(q,p)}if((k!=null?k.controllers:void 0)!=null){v=k.controllers;for(e in v)f=v[e],c.addController(e,f)}if((k!=null?k.facets:void 0)!=null){w=k.facets;for(h in w)i=w[h],c.addFacet(h,i)}if((k!=null?k.components:void 0)!=null){x=k.components;for(e in x)f=x[e],c.addComponent(e,f)}if((k!=null?k.presentations:void 0)!=null){y=k.presentations;for(l in y)m=y[l],c.addPresentation(l,m)}if((k!=null?k.plugins:void 0)!=null){z=k.plugins,A=[];for(r=0,s=z.length;r<s;r++)m=z[r],A.push(c.addPlugin(m));return A}}]))}}),b.namespace("Plugin",function(a){return a.initInstance=function(a,b){var c,d;d={options:b,presentation:{}},c=[],d.getTypes=function(){return(b!=null?b.types:void 0)!=null?b.types:[]},d.getProperties=function(){return(b!=null?b.properties:void 0)!=null?b.properties:[]},d.getComponents=function(){return(b!=null?b.components:void 0)!=null?b.components:[]},d.getPresentations=function(){return(b!=null?b.presentations:void 0)!=null?b.presentations:[]},d.ready=c.push,d.eventReady=function(a){var b,e,f;for(e=0,f=c.length;e<f;e++)b=c[e],b(a);c=[];return d.ready=function(b){return b(a)}};return d}}),b.initView=b.deprecated("MITHGrid.initView",b.initInstance),b.Data.initSet=b.deprecated("MITHGrid.Data.initSet",b.Data.Set.initInstance),b.Data.initType=b.deprecated("MITHGrid.Data.initType",b.Data.Type.initInstance),b.Data.initProperty=b.deprecated("MITHGrid.Data.initProperty",b.Data.Property.initInstance),b.Data.initStore=b.deprecated("MITHGrid.Data.initStore",b.Data.Store.initInstance),b.Data.initView=b.deprecated("MITHGrid.Data.initView",b.Data.View.initInstance),b.Presentation.initPresentation=b.deprecated("MITHGrid.Presentation.initPresentation",b.Presentation.initInstance),b.Presentation.SimpleText.initPresentation=b.deprecated("MITHGrid.Presentation.SimpleText.initPresentation",b.Presentation.SimpleText.initInstance);return b.Application.initApp=b.deprecated("MITHGrid.Application.initApp",b.Application.initInstance)}(b,a),a.defaults("MITHGrid.Data.Store",{events:{onModelChange:null,onBeforeLoading:null,onAfterLoading:null,onBeforeUpdating:null,onAfterUpdating:null}}),a.defaults("MITHGrid.Data.View",{events:{onModelChange:null,onFilterItem:"preventable"}}),a.defaults("MITHGrid.Data.SubSet",{events:{onModelChange:null}}),a.defaults("MITHGrid.Data.Pager",{events:{onModelChange:null}}),a.defaults("MITHGrid.Data.RangePager",{events:{onModelChange:null}}),a.defaults("MITHGrid.Data.ListPager",{events:{onModelChange:null}}),a.defaults("MITHGrid.Facet",{events:{onFilterChange:null}}),a.defaults("MITHGrid.Facet.TextSearch",{facetLabel:"Search",expressions:[".label"]})}).call(this)
;